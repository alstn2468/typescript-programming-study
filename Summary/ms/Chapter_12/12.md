# 12ì¥ í”„ë¡œì íŠ¸ ì‹¤ìŠµ

<details><summary>Table of Contents</summary>

-   12-1 ë¹…ë°ì´í„° ë°°ì¹˜ í”„ë¡œê·¸ë¨ ë§Œë“¤ê¸° [:link:](#12-1-ë¹…ë°ì´í„°-ë°°ì¹˜-í”„ë¡œê·¸ë¨-ë§Œë“¤ê¸°)
    -   ì‹¤ìŠµ í”„ë¡œì íŠ¸ êµ¬ì„± [:link:](#ì‹¤ìŠµ-í”„ë¡œì íŠ¸-êµ¬ì„±)
    -   CSV íŒŒì¼ê³¼ ìƒì„±ê¸° [:link:](#csv-íŒŒì¼ê³¼-ìƒì„±ê¸°)
    -   node.jsì—ì„œ í”„ë¡œê·¸ë¨ ëª…ë ¹ ì¤„ ì¸ìˆ˜ ì½ê¸° [:link:](#nodejsì—ì„œ-í”„ë¡œê·¸ë¨-ëª…ë ¹-ì¤„-ì¸ìˆ˜-ì½ê¸°)
    -   íŒŒì¼ ì²˜ë¦¬ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ Promiseë¡œ êµ¬í˜„í•˜ê¸° [:link:](#íŒŒì¼-ì²˜ë¦¬-ë¹„ë™ê¸°-í•¨ìˆ˜ë¥¼-promiseë¡œ-êµ¬í˜„í•˜ê¸°)
    -   ê·¸ëŸ´ë“¯í•œ ê°€ì§œ ë°ì´í„° ë§Œë“¤ê¸° [:link:](#ê·¸ëŸ´ë“¯í•œ-ê°€ì§œ-ë°ì´í„°-ë§Œë“¤ê¸°)
    -   Object.keysì™€ Object.values í•¨ìˆ˜ ì‚¬ìš©í•˜ê¸° [:link:](#objectkeysì™€-objectvalues-í•¨ìˆ˜-ì‚¬ìš©í•˜ê¸°)
    -   CSV íŒŒì¼ ë§Œë“¤ê¸° [:link:](#csv-íŒŒì¼-ë§Œë“¤ê¸°)
    -   ë°ì´í„°ë¥¼ CSV íŒŒì¼ì— ì“°ê¸° [:link:](#ë°ì´í„°ë¥¼-csv-íŒŒì¼ì—-ì“°ê¸°)
    -   zip í•¨ìˆ˜ ë§Œë“¤ê¸° [:link:](#zip-í•¨ìˆ˜-ë§Œë“¤ê¸°)
    -   CSV íŒŒì¼ ë°ì´í„° ì½ê¸° [:link:](#csv-íŒŒì¼-ë°ì´í„°-ì½ê¸°)
-   12-2 ëª½ê³ DBì— ë°ì´í„° ì €ì¥í•˜ê¸° [:link:](#12-2-ëª½ê³ dbì—-ë°ì´í„°-ì €ì¥í•˜ê¸°)
    -   ëª½ê³ DBë€? [:link:](#ëª½ê³ dbë€)
    -   ëª½ê³ DB ì„¤ì¹˜ [:link:](#ëª½ê³ db-ì„¤ì¹˜)
    -   í”„ë¡œì íŠ¸ êµ¬ì„± [:link:](#í”„ë¡œì íŠ¸-êµ¬ì„±)
    -   ëª½ê³ DBì— ì ‘ì†í•˜ê¸° [:link:](#ëª½ê³ dbì—-ì ‘ì†í•˜ê¸°)
    -   ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° [:link:](#ë°ì´í„°ë² ì´ìŠ¤-ì—°ê²°)
    -   ì»¬ë ‰ì…˜ì´ë€? [:link:](#ì»¬ë ‰ì…˜ì´ë€)
    -   ë¬¸ì„œë¥¼ ì»¬ë ‰ì…˜ì— ì €ì¥í•˜ê¸° [:link:](#ë¬¸ì„œë¥¼-ì»¬ë ‰ì…˜ì—-ì €ì¥í•˜ê¸°)
    -   ëª½ê³  ì…¸ì— ì ‘ì†í•˜ê¸° [:link:](#ëª½ê³ -ì…¸ì—-ì ‘ì†í•˜ê¸°)
    -   \_idì†ì„±ê³¼ ObjectId íƒ€ì… [:link:](#_idì†ì„±ê³¼-objectid-íƒ€ì…)
    -   ë¬¸ì„œ ì°¾ê¸° [:link:](#ë¬¸ì„œ-ì°¾ê¸°)
    -   ë¬¸ì„œ ì‚­ì œí•˜ê¸° [:link:](#ë¬¸ì„œ-ì‚­ì œí•˜ê¸°)
    -   ê²€ìƒ‰ ê²°ê³¼ ì •ë ¬í•˜ê¸° [:link:](#ê²€ìƒ‰-ê²°ê³¼-ì •ë ¬í•˜ê¸°)
    -   CSV íŒŒì¼ì„ ëª½ê³ DBì— ì €ì¥í•˜ê¸° [:link:](#csv-íŒŒì¼ì„-ëª½ê³ dbì—-ì €ì¥í•˜ê¸°)
    -   limitê³¼ skip ë©”ì„œë“œ [:link:](#limitê³¼-skip-ë©”ì„œë“œ)
-   12-3 ìµìŠ¤í”„ë ˆìŠ¤ë¡œ API ì„œë²„ ë§Œë“¤ê¸° [:link:](#12-3-ìµìŠ¤í”„ë ˆìŠ¤ë¡œ-api-ì„œë²„-ë§Œë“¤ê¸°)
    -   ì‹¤ìŠµ í”„ë¡œì íŠ¸ êµ¬ì„± [:link:](#project-setup-two)
    -   REST ë°©ì‹ ì„œë²„ [:link:](#rest-ë°©ì‹-ì„œë²„)
    -   ìµìŠ¤í”„ë ˆìŠ¤ í”„ë ˆì„ì›Œí¬ [:link:](#ìµìŠ¤í”„ë ˆìŠ¤-í”„ë ˆì„ì›Œí¬)
    -   ë¼ìš°íŒ… ê¸°ëŠ¥ êµ¬í˜„ [:link:](#ë¼ìš°íŒ…-ê¸°ëŠ¥-êµ¬í˜„)
    -   ìµìŠ¤í”„ë ˆìŠ¤ ë¯¸ë“¤ì›¨ì–´ ì¶”ê°€ [:link:](#ìµìŠ¤í”„ë ˆìŠ¤-ë¯¸ë“¤ì›¨ì–´-ì¶”ê°€)
    -   ëª½ê³ DB ì—°ê²° [:link:](#ëª½ê³ db-ì—°ê²°)
-   12-4 ë¦¬ì•¡íŠ¸ì™€ ë¶€íŠ¸ìŠ¤íŠ¸ë©ìœ¼ë¡œ í”„ë¡ íŠ¸ì—”ë“œ ì›¹ ë§Œë“¤ê¸° [:link:](#12-4-ë¦¬ì•¡íŠ¸ì™€-ë¶€íŠ¸ìŠ¤íŠ¸ë©ìœ¼ë¡œ-í”„ë¡ íŠ¸ì—”ë“œ-ì›¹-ë§Œë“¤ê¸°)
    -   ì‹¤ìŠµ í”„ë¡œì íŠ¸ êµ¬ì„± [:link:](#project-setup-three)
    -   App.tsx íŒŒì¼ ìˆ˜ì • [:link:](#apptsx-íŒŒì¼-ìˆ˜ì •)
    -   JSXë€? [:link:](#jsxë€)
    -   ì»´í¬ë„ŒíŠ¸ë€? [:link:](#ì»´í¬ë„ŒíŠ¸ë€)
    -   API ì„œë²„ì—ì„œ ì‹¤ì œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° [:link:](#api-ì„œë²„ì—ì„œ-ì‹¤ì œ-ë°ì´í„°-ê°€ì ¸ì˜¤ê¸°)
    -   useState í•¨ìˆ˜ ì‚¬ìš©í•˜ê¸° [:link:](#usestate-í•¨ìˆ˜-ì‚¬ìš©í•˜ê¸°)
    -   useEffect í•¨ìˆ˜ ì‚¬ìš©í•˜ê¸° [:link:](#useeffect-í•¨ìˆ˜-ì‚¬ìš©í•˜ê¸°)
    -   ì„œë²„ì—ì„œ ë°ì´í„° ê³„ì† ê°€ì ¸ì˜¤ê¸° [:link:](#ì„œë²„ì—ì„œ-ë°ì´í„°-ê³„ì†-ê°€ì ¸ì˜¤ê¸°)
    -   ë¶€íŠ¸ìŠ¤íŠ¸ë¨ CSS í”„ë ˆì„ì›Œí¬ ì‚¬ìš©í•˜ê¸° [:link:](#ë¶€íŠ¸ìŠ¤íŠ¸ë¨-css-í”„ë ˆì„ì›Œí¬-ì‚¬ìš©í•˜ê¸°)
    -   ì¹´ë“œ ì»´í¬ë„ŒíŠ¸ ë§Œë“¤ê¸° [:link:](#ì¹´ë“œ-ì»´í¬ë„ŒíŠ¸-ë§Œë“¤ê¸°)

</details>

## 12-1 ë¹…ë°ì´í„° ë°°ì¹˜ í”„ë¡œê·¸ë¨ ë§Œë“¤ê¸°

### ì‹¤ìŠµ í”„ë¡œì íŠ¸ êµ¬ì„±

ì´ í”„ë¡œì íŠ¸ì—ì„œëŠ” `node.js`ì˜ `fs` íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ `@types/node` íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œë‹¤.<br/>
ì•„ë˜ì˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ `package.json` íŒŒì¼ì„ ìƒì„±í•˜ê³  íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œë‹¤.<br/>

```shell
> npm init --y
> npm i -D typescript ts-node @types/node
```

í´ë”ë¥¼ ìƒì„±í•˜ê³  ì‚­ì œí•˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸° ìœ„í•´ ì•„ë˜ì˜ ë‘ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œë‹¤.<br/>

```shell
> npm i -S mkdirp rimraf
> npm i -D @types/mkdirp @types/rimraf
```

ë˜í•œ ê°€ì§œ ë°ì´í„°ë¥¼ ë§Œë“¤ì–´ì£¼ëŠ” `chance` íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•œë‹¤.<br/>

```shell
> npm i -S chance
> npm i -D @types/chance
```

`tsconfig.json` íŒŒì¼ì€ ì•„ë˜ì™€ ê°™ì´ ì„¤ì •í•œë‹¤.<br/>

```json
{
    "compilerOptions": {
        "module": "CommonJS",
        "esModuleInterop": true,
        "target": "es5",
        "moduleResolution": "node",
        "outDir": "dist",
        "baseUrl": ".",
        "sourceMap": true,
        "downlevelIteration": true,
        "noImplicitAny": false,
        "paths": {
            "*": ["node_modules/*"]
        }
    },
    "include": ["src/**/*"]
}
```

ì•„ë˜ì™€ ê°™ì´ í”„ë¡œì íŠ¸ì— í•„ìš”í•œ í´ë”ë“¤ì„ ìƒì„±í•´ì¤€ë‹¤.<br/>

```shell
> mkdir -p src/fileApi
> mkdir src/fake
> mkdir src/csv
> mkdir src/utils
> mkdir src/test
```

### CSV íŒŒì¼ê³¼ ìƒì„±ê¸°

Javascriptë‚˜ TypescriptëŠ” íŒŒì¼ì— ë°ì´í„°ë¥¼ ì €ì¥í•  ë•Œ ì£¼ë¡œ `JSON` í¬ë§·ì„ ì‚¬ìš©í•œë‹¤.<br/>
í•˜ì§€ë§Œ ì €ì¥í•  ë°ì´í„°ì˜ ì–‘ì´ ë§ì•„ì§€ë©´ `JSON`íŒŒì¼ í¬ë§·ì€ ì‹œìŠ¤í…œ ë©”ëª¨ë¦¬ë¥¼ ë§ì´ ì‚¬ìš©í•œë‹¤.<br/>
ë”°ë¼ì„œ ë°ì´í„°ë¥¼ íŒŒì¼ì— ì €ì¥í•  ë•ŒëŠ” `JSON`ì²˜ëŸ¼ ë‚˜ì¤‘ì— ì½ê¸° ì‰¬ìš´ í˜•ì‹ìœ¼ë¡œ ë§Œë“ ë‹¤.<br/>
ë³´í†µ í…Œì´ë¸” í˜•íƒœì˜ ë°ì´í„°ëŠ” íŒŒì¼ í™•ì¥ìê°€ `csv`ì¸ íŒŒì¼ì— ì €ì¥í•œë‹¤.<br/>
CSV íŒŒì¼ì€ ë°ì´í„°ê°€ ì•„ë˜ì™€ ê°™ì€ í˜•ì‹ìœ¼ë¡œ ì €ì¥ëœ íŒŒì¼ì„ ë§í•œë‹¤.<br/>

```csv
name,email,ip,phone
Leona Alexander,ikefo@ved.ws,32.133.3.226,(502) 739-6533
```

CSV íŒŒì¼ í˜•ì‹ì€ ë§¨ ì²« ì¤„ì˜ í—¤ë” ì •ë³´ì— ë°ì´í„°ë¥¼ ë‚˜íƒ€ë‚´ëŠ” ì´ë¦„ì„ `,`ë¡œ êµ¬ë¶„í•œë‹¤.<br/>
ê·¸ ë‹¤ìŒ ì¤„ë¶€í„°ëŠ” ê° ì´ë¦„ì— í•´ë‹¹í•˜ëŠ” ë°ì´í„°ë¥¼ ë˜‘ê°™ì´ `,`ë¡œ êµ¬ë¶„í•´ ë†“ì„ ìˆ˜ ìˆë‹¤.<br/>
ë˜í•œ CSVíŒŒì¼ì€ JSONíŒŒì¼ê³¼ ë‹¬ë¦¬ ë°ì´í„°ë¥¼ í•œêº¼ë²ˆì— ì½ì§€ ì•Šê³  í•œì¤„ ì”© ì½ëŠ”ë‹¤.<br/>
**ìƒì„±ê¸°**ëŠ” ì‹œìŠ¤í…œ ìì›ì„ ë§¤ìš° ì ê²Œ ì†Œëª¨í•˜ë©° ì—„ì²­ë‚œ ë¶„ëŸ‰ì˜ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•œë‹¤.<br/>
CSVíŒŒì¼ì„ í•œ ì¤„ì”© ì½ìœ¼ë©° Typescript ê°ì²´ë¡œ ë³€í™˜í•œ í›„ `yield`ë¬¸ìœ¼ë¡œ ë„˜ê²¨ì¤„ ìˆ˜ ìˆë‹¤.<br/>
`for...of` êµ¬ë¬¸ìœ¼ë¡œ `yield`ë¬¸ìœ¼ë¡œ ë„˜ê²¨ë°›ì€ í•˜ë‚˜ì˜ ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ì‘ì—…ì„ ì§„í–‰í•œë‹¤.<br/>

### node.jsì—ì„œ í”„ë¡œê·¸ë¨ ëª…ë ¹ ì¤„ ì¸ìˆ˜ ì½ê¸°

`node.js` í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•˜ë©´ ì•„ë˜ì²˜ëŸ¼ ì‹¤í–‰ ëª…ë ¹ ë’¤ì— ì—¬ëŸ¬ ê°œì˜ ë§¤ê°œë³€ìˆ˜ë¥¼ ì…ë ¥í•  ìˆ˜ ìˆë‹¤.<br/>

```shell
> ts-node src/test/processArgs-test.ts data/fake.csv 100000
```

ì´ì™€ ê°™ì´ í”„ë¡œê·¸ë¨ì„ ì‹¤í–‰í•  ë•Œ ì™¸ë¶€ì—ì„œ ì…ë ¥ëœ ê°’ì„ **ëª…ë ¹ ì¤„ ì¸ìˆ˜**ë¼ê³  í•œë‹¤.<br/>
`node.js`ê°€ ì œê³µí•˜ëŠ” `process` ë‚´ì¥ ê°ì²´ì˜ `argv` ë°°ì—´ ì†ì„±ì—ì„œ **ëª…ë ¹ ì¤„ ì¸ìˆ˜**ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.<br/>

-   `test/processArgs-Test.ts`

```typescript
process.argv.forEach((val: string, index: number) => {
    console.log(index + ": " + val);
});
```

-   `test/processArgs-Test.ts` ì‹¤í–‰ê²°ê³¼

```shell
0: C:\...\nodejs\node_modules\ts-node\dist\bin.js
1: C:\...\test\processArgs-test.ts
2: data/fake.csv
3: 100000
```

ìœ„ì™€ ê°™ì´ `data/fake.csv`ì™€ `100000` ê°’ì€ `index`ê°€ `2`ì™€ `3`ì¼ ë•Œ ì–»ì–´ì§€ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/>
ì´ ë‚´ìš©ì„ ë°”íƒ•ìœ¼ë¡œ `utils` í´ë”ì— `getFileNameAndNumber.ts` í•¨ìˆ˜ë¥¼ ì‘ì„±í•œë‹¤.<br/>

-   `utils/getFileNameAndNumber.ts`

```typescript
export type FileNameAndNumber = [string, number];

export const getFileNameAndNumber = (
    defaultFileName: string,
    defaultNumberOfFakeData: number
): FileNameAndNumber => {
    const [bin, node, filename, numberOfFakeData] = process.argv;
    return [
        filename || defaultFileName,
        numberOfFakeData
            ? parseInt(numberOfFakeData, 10)
            : defaultNumberOfFakeData,
    ];
};
```

ì•„ë˜ì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‚¬ìš©í•´ ì‘ì„±í•œ `getFileNameAndNumber` í•¨ìˆ˜ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤.<br/>

-   `test/getFileNameAndNumber-Test.ts`

```typescript
import { getFileNameAndNumber } from "../utils/getFileNameAndNumber";

const [fileName, numberOfFakeItems] = getFileNameAndNumber(
    "data/fake.csv",
    100000
);
console.log(fileName, numberOfFakeItems); // data/fake.csv 100000
```

ìœ„ì™€ ê°™ì´ **ëª…ë ¹ ì¤„ ì¸ìˆ˜**ë¡œ ë„˜ê¸´ íŒŒì¼ ì´ë¦„ê³¼ ìˆ«ìë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.<br/>

### íŒŒì¼ ì²˜ë¦¬ ë¹„ë™ê¸° í•¨ìˆ˜ë¥¼ Promiseë¡œ êµ¬í˜„í•˜ê¸°

#### (1) fs.access APIë¡œ ë””ë ‰í„°ë¦¬ë‚˜ íŒŒì¼ í™•ì¸í•˜ê¸°

`fs.access` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ íŒŒì¼ì´ë‚˜ ë””ë ‰í„°ë¦¬ê°€ ìˆëŠ”ì§€ ì—†ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/>
ì•„ë˜ ì½”ë“œëŠ” íŒŒì¼ì´ë‚˜ ë””ë ‰í„°ë¦¬ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ëŠ” ê¸°ëŠ¥ì„ `Promise` í˜•íƒœë¡œ êµ¬í˜„í–ˆë‹¤.<br/>

-   `fileApi/fileExists.ts`

```typescript
import * as fs from "fs";

export const fileExists = (filePath: string): Promise<boolean> =>
    new Promise((resolve) =>
        fs.access(filePath, (error) => resolve(error ? false : true))
    );
```

`fs.access` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ íŒŒì¼ì´ë‚˜ ë””ë ‰í„°ë¦¬ê°€ ìˆëŠ”ì§€ í™•ì¸í•´ `Promise`ë¥¼ ë°˜í™˜í•œë‹¤.<br/>
ì•„ë˜ì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œ ì‘ì„±í•œ `fileExists` í•¨ìˆ˜ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤.<br/>

-   `test/fileExists-Test.ts`

```typescript
import { fileExists } from "../fileApi/fileExists";

const exists = async (filePath) => {
    const result = await fileExists(filePath);
    console.log(`${filePath} ${result ? "exists" : "not exists"}`);
};

exists("./package.json"); // ./package.json exists
exists("./package"); // ./package not exists
```

ìœ„ì™€ ê°™ì´ íŒŒì¼ì´ë‚˜ ë””ë ‰í„°ë¦¬ì˜ ì¡´ì¬ì—¬ë¶€ë¥¼ í™•ì¸í•  ìˆ˜ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/>

#### (2) mkdirp íŒ¨í‚¤ì§€ë¡œ ë””ë ‰í„°ë¦¬ ìƒì„± í•¨ìˆ˜ ë§Œë“¤ê¸°

`node.js`ëŠ” `mkdir`ì´ë¼ëŠ” APIë¥¼ ì œê³µí•œë‹¤.<br/>
í•˜ì§€ë§Œ `mkdir`ì€ `./src/data/today`ì²˜ëŸ¼ ì—¬ëŸ¬ ê²½ë¡œì˜ ë””ë ‰í„°ë¦¬ë¥¼ í•œë²ˆì— ë§Œë“¤ì§€ëŠ” ëª»í•œë‹¤.<br/>
ë°˜ë©´ì— `mkdirp` íŒ¨í‚¤ì§€ëŠ” `mkdir -p` ì²˜ëŸ¼ í•œë²ˆì— ì—¬ëŸ¬ ë””ë ‰í„°ë¦¬ë¥¼ ë§Œë“œëŠ” ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.<br/>
ì•„ë˜ ì½”ë“œëŠ” ë””ë ‰í„°ë¦¬ê°€ ìˆëŠ”ì§€ë¥¼ íŒë‹¨í•´ ì—†ì„ ë•Œë§Œ `mkdirp` í•¨ìˆ˜ë¡œ ë””ë ‰í„°ë¦¬ë¥¼ ìƒì„±í•œë‹¤.<br/>

-   `fileApi/mkdir.ts`

```typescript
import mkdirp from "mkdirp";
import { fileExists } from "./fileExists";

export const mkdir = (dirname: string): Promise<string> =>
    new Promise(async (resolve, reject) => {
        const alreadyExists = await fileExists(dirname);
        alreadyExists
            ? resolve(dirname)
            : mkdirp(dirname, (error) =>
                  error ? reject(error) : resolve(dirname)
              );
    });
```

ì•„ë˜ì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œ ë™ì‘ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/>

-   `test/mkdir-Test.ts`

```typescript
import { mkdir } from "../fileApi/mkdir";

const makeDataDir = async (dirname: string) => {
    let result = await mkdir(dirname);
    console.log(`'${result}' dir created`);
};

makeDataDir("./data/today"); // './data/today' dir created
```

ìœ„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ í”„ë¡œì íŠ¸ ê²½ë¡œì— `data` í´ë”ì™€ ê·¸ ì•ˆì— `today` í´ë”ê°€ ìƒê¸´ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/>

#### (3) rimraf íŒ¨í‚¤ì§€ë¡œ ë””ë ‰í„°ë¦¬ ì‚­ì œ í•¨ìˆ˜ ë§Œë“¤ê¸°

`node.js`ëŠ” í´ë”ë¥¼ ì‚­ì œí•˜ëŠ” `fs.rmdir`ì´ë¼ëŠ” í•¨ìˆ˜ë¥¼ ì œê³µí•œë‹¤.<br/>
`fs.rmdir` í•¨ìˆ˜ëŠ” ë¹„ì–´ ìˆì§€ ì•Šì€ ë””ë ‰í„°ë¥´ëŠ” ì‚­ì œí•˜ì§€ ëª»í•˜ëŠ” ë¬¸ì œì ì´ ìˆë‹¤.<br/>
`rimraf` íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•˜ë©´ ë¹„ì–´ ìˆì§€ ì•Šì€ ë””ë ‰í„°ë¦¬ ë˜í•œ ì‚­ì œí•  ìˆ˜ ìˆë‹¤.<br/>
ì•„ë˜ ì½”ë“œëŠ” `rimraf` í•¨ìˆ˜ë¡œ ë””ë ‰í„°ë¦¬ ì‚­ì œ í•¨ìˆ˜ `rmdir`ì„ êµ¬í˜„í•œë‹¤.<br/>

-   `fileApi/rmdir.ts`

```typescript
import rimraf from "rimraf";
import { fileExists } from "./fileExists";

export const rmdir = (dirname: string): Promise<string> =>
    new Promise(async (resolve, reject) => {
        const alreadyExists = await fileExists(dirname);
        !alreadyExists
            ? resolve(dirname)
            : rimraf(dirname, (error) =>
                  error ? reject(error) : resolve(dirname)
              );
    });
```

ì•„ë˜ì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œë¡œ ë™ì‘ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/>

-   `test/rmdir-Test.ts`

```typescript
import { rmdir } from "../fileApi/rmdir";

const deleteDataDir = async (dir) => {
    const result = await rmdir(dir);
    console.log(`'${result}' dir deleted.`);
};

deleteDataDir("./data/today"); // './data/today' dir deleted.
```

ìœ„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´ í”„ë¡œì íŠ¸ ê²½ë¡œì— `today` í´ë”ê°€ ì‚­ì œ ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/>

#### (4) fs.writeFile APIë¡œ íŒŒì¼ ìƒì„±í•˜ê¸°

`node.js` í™˜ê²½ì—ì„œ íŒŒì¼ì˜ ë°ì´í„°ë¥¼ ì½ê±°ë‚˜ ì“¸ ë•ŒëŠ” ëŒ€ë¶€ë¶„ í…ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•œë‹¤.<br/>
í…ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•  ë•Œì—ëŠ” ìœ ë‹ˆì½”ë“œë¡œ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•´ì•¼í•œë‹¤.<br/>
ìœ ë‹ˆì½”ë“œ í…ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•  ë•Œ `fs.writeFile` APIëŠ” ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.<br/>

```typescript
import * as fs from "fs";

fs.writeFile(filepath, data, "utf8", callback);
```

ì•„ë˜ ì½”ë“œëŠ” `fs.writeFile`ì„ `Promise`ë¥¼ ë°˜í™˜í•˜ë„ë¡ êµ¬í˜„í•œ í•¨ìˆ˜ë‹¤.<br/>

-   `fileApi/writeFile.ts`

```typescript
import * as fs from "fs";

export const writeFile = (filename: string, data: any): Promise<any> =>
    new Promise((resolve, reject) => {
        fs.writeFile(filename, data, "utf8", (error: Error) => {
            error ? reject(error) : resolve(data);
        });
    });
```

ì•„ë˜ì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” `./data` í´ë”ë¥¼ ìƒì„±í•˜ê³  `hello.txt`ì™€ `test.json` íŒŒì¼ì„ ì‘ì„±í•˜ëŠ” ì˜ˆì‹œë‹¤.<br/>

-   `test/writeFile-Test.ts`

```typescript
import { writeFile } from "../fileApi/writeFile";
import { mkdir } from "../fileApi/mkdir";

const writeTest = async (filename: string, data: any) => {
    const result = await writeFile(filename, data);
    console.log(`wrtie ${result} to ${filename}`);
};

mkdir("./data")
    .then((s) => writeTest("./data/hello.txt", "hello world"))
    .then((s) =>
        writeTest(
            "./data/test.json",
            JSON.stringify({ name: "Jack", age: 32 }, null, 2)
        )
    )
    .catch((e: Error) => console.log(e.message));

// wrtie hello world to ./data/hello.txt
// wrtie {
//   "name": "Jack",
//   "age": 32
// } to ./data/test.json
```

`hello.txt`ì™€ `test.json` íŒŒì¼ì´ ìƒì„±ë˜ê³  ë‚´ìš©ì´ ì‘ì„±ë˜ì–´ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/>
ê°ì²´ë¥¼ ë¬¸ìì—´ë¡œ ë°”ê¾¸ëŠ” ê¸°ëŠ¥ì˜ ê¸°ë³¸ì ì¸ ì‚¬ìš©ë²•ì€ `JSON.stringify(object)`ê³¼ ê°™ì´ ì‚¬ìš©í•œë‹¤.<br/>
`JSON.stringify(object, null, 2)`ìœ¼ë¡œ ì‚¬ìš©í•´ ì¤„ë°”ê¿ˆê³¼ ë“¤ì—¬ì“°ê¸°ê°€ ë˜ì–´ìˆëŠ” ë°ì´í„°ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.<br/>
ì—¬ê¸°ì—ì„œ 3ë²ˆì§¸ ì¸ìë¡œ ë„˜ê²¨ì§„ `2`ëŠ” ë“¤ì—¬ì“°ê¸°ë¥¼ ìœ„í•œ ê³µë°± ë¬¸ìì˜ ê°œìˆ˜ë¥¼ ì˜ë¯¸í•œë‹¤.<br/>

#### (5) fs.readFile APIë¡œ íŒŒì¼ ë‚´ìš© ì½ê¸°

íŒŒì¼ì— ë‹´ê¸´ ë°ì´í„°ë¥¼ ì½ì„ ë•ŒëŠ” `fs.readFile` APIë¥¼ ì‚¬ìš©í•œë‹¤.<br/>
íŒŒì¼ì— ë‹´ê¸´ ë°ì´í„°ëŠ” í…ìŠ¤íŠ¸ í¬ë§·ê³¼ ë°”ì´ë„ˆë¦¬ í¬ë§·ìœ¼ë¡œ ì½ì„ ìˆ˜ ìˆë‹¤.<br/>
ë³´í†µ `node.js` í™˜ê²½ì—ì„œ íŒŒì¼ì˜ ë°ì´í„°ë¥¼ ì½ê±°ë‚˜ ì“¸ ë•ŒëŠ” `utf8` í¬ë§·ì„ ì‚¬ìš©í•œë‹¤.<br/>
`fs.readFile` APIë¥¼ ì´ìš©í•´ ìœ ë‹ˆì½”ë“œ í…ìŠ¤íŠ¸ë¥¼ ì½ì„ ë•ŒëŠ” ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•œë‹¤.<br/>

```typescript
import * as fs from "fs";

fs.readFile(filepath, "utf8", callback);
```

ì•„ë˜ ì½”ë“œëŠ” `fs.readFile`ì„ `Promise`ë¥¼ ë°˜í™˜í•˜ë„ë¡ êµ¬í˜„í•œ í•¨ìˆ˜ë‹¤.<br/>

-   `fileApi/readFile.ts`

```typescript
import * as fs from "fs";

export const readFile = (filename: string): Promise<any> =>
    new Promise<any>((resolve, reject) => {
        fs.readFile(filename, "utf8", (error: Error, data: any) => {
            error ? reject(error) : resolve(data);
        });
    });
```

ì•„ë˜ì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ”`hello.txt`ì™€ `test.json` íŒŒì¼ì„ `readFile` í•¨ìˆ˜ë¡œ ì½ëŠ” ì˜ˆì‹œë‹¤.<br/>

-   `test/readFile-Test.ts`

```typescript
import { readFile } from "../fileApi/readFile";

const readTest = async (filename: string) => {
    const result = await readFile(filename);
    console.log(`read '${result}' from ${filename} file.`);
};

readTest("./data/hello.txt")
    .then((s) => readTest("./data/test.json"))
    .catch((e: Error) => console.log(e.message));

// read 'hello world' from ./data/hello.txt file.
// read '{
// "name": "Jack",
//     "age": 32
// }' from ./data/test.json file.
```

ìœ„ì™€ ê°™ì´ `writeFile`ë¡œ ìƒì„±í•œ ë‘ ê°œì˜ íŒŒì¼ë“¤ì„ ì˜ ì½ì–´ì˜¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/>

#### (6) fs.appendFile APIë¡œ íŒŒì¼ ë‚´ìš© ì¶”ê°€í•˜ê¸°

`fs.writeFile`ì€ íŒŒì¼ì´ ì´ë¯¸ ì¡´ì¬í•  ë•ŒëŠ” ê¸°ì¡´ íŒŒì¼ ë‚´ìš©ì„ ëª¨ë‘ ì§€ìš°ê³  ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì“´ë‹¤.<br/>
ê¸°ì¡´ ë‚´ìš©ì„ ëì— ìƒˆë¡œìš´ ë°ì´í„°ë¥¼ ì‚½ì…í•˜ê³ ì í•œë‹¤ë©´ `fs.appendFile`ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤.<br/>
ì•„ë˜ ì½”ë“œëŠ” `fs.appendFile`ì„ `Promise`ë¥¼ ë°˜í™˜í•˜ë„ë¡ êµ¬í˜„í•œ í•¨ìˆ˜ë‹¤.<br/>

-   `fileApi/appendFile.ts`

```typescript
import * as fs from "fs";

export const appendFile = (filename: string, data: any): Promise<any> =>
    new Promise((resolve, reject) => {
        fs.appendFile(filename, data, "utf8", (error: Error) => {
            error ? reject(error) : resolve(data);
        });
    });
```

ì•„ë˜ í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” `./data/hello.txt`ì— `"Hi, there!"`ì´ë¼ëŠ” ë¬¸ìì—´ì„ ì¶”ê°€í•œë‹¤.<br/>

-   `test/appendFile-Test.ts`

```typescript
import { appendFile } from "../fileApi/appendFile";
import { mkdir } from "../fileApi/mkdir";

const appendTest = async (filename: string, data: any) => {
    const result = await appendFile(filename, data);
    console.log(`append ${result} to ${filename}`);
};

mkdir("./data")
    .then((s) => appendTest("./data/hello.txt", "Hi, there!"))
    .catch((e: Error) => console.log(e.message));

// append Hi, there! to ./data/hello.txt
```

`hello.txt`ë¥¼ í™•ì¸í•´ë³´ë©´ `hello worldHi, there!` ê°™ì´ ë°ì´í„°ë¥¼ ìœ ì§€í•˜ë©° ì¶”ê°€ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/>

#### (7) fs.unlink APIë¡œ íŒŒì¼ ì‚­ì œí•˜ê¸°

`node.js` í™˜ê²½ì—ì„œ íŒŒì¼ì„ ì‚­ì œí•  ë•ŒëŠ” `fs.unlink` APIë¥¼ ì‚¬ìš©í•œë‹¤.<br/>
ì•„ë˜ì˜ `deleteFile` í•¨ìˆ˜ëŠ” íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ”ì§€ íŒë³„í•´ ì¡´ì¬í•  ë•Œ íŒŒì¼ì„ ì‚­ì œí•˜ëŠ” ê¸°ëŠ¥ì„ í•œë‹¤.<br/>

-   `fileApi/deleteFile.ts`

```typescript
import * as fs from "fs";
import { fileExists } from "./fileExists";

export const deleteFile = (filename: string): Promise<string> =>
    new Promise<any>(async (resolve, reject) => {
        const alreadyExists = await fileExists(filename);
        !alreadyExists
            ? resolve(filename)
            : fs.unlink(filename, (error) =>
                  error ? reject(error) : resolve(filename)
              );
    });
```

ì•„ë˜ í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” `./data` í´ë”ì— ìˆëŠ” ë°ì´í„°ì™€ `./data` í´ë”ë¥¼ ì‚­ì œí•œë‹¤.<br/>

-   `test/deleteFile-Test.ts`

```typescript
import { deleteFile } from "../fileApi/deleteFile";
import { rmdir } from "../fileApi/rmdir";

const deleteTest = async (filename: string) => {
    const result = await deleteFile(filename);
    console.log(`delete ${result} file.`);
};

Promise.all([deleteTest("./data/hello.txt"), deleteTest("./data/test.json")])
    .then((s) => rmdir("./data"))
    .then((dirname) => console.log(`delete ${dirname} dir.`))
    .catch((e: Error) => console.log(e.message));

//delete ./data/test.json file.
//delete ./data/hello.txt file.
//delete ./data dir.
```

ìœ„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ `./data` í´ë” ë‚´ë¶€ì˜ íŒŒì¼ê³¼ `./data`í´ë”ê°€ ì‚­ì œë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/>

#### (8) fileApi/index.ts íŒŒì¼ ë§Œë“¤ê¸°

`src/fileApi` í´ë”ì— `index.ts` íŒŒì¼ì„ ìƒì„±í•˜ê³  ì•„ë˜ì˜ ë‚´ìš©ì„ ì‘ì„±í•œë‹¤.<br/>

-   `fileApi/index.ts`

```typescript
import { mkdir } from "./mkdir";
import { rmdir } from "./rmdir";
import { readFile } from "./readFile";
import { writeFile } from "./writeFile";
import { fileExists } from "./fileExists";
import { appendFile } from "./appendFile";
import { deleteFile } from "./deleteFile";

export {
    fileExists,
    mkdir,
    rmdir,
    writeFile,
    readFile,
    appendFile,
    deleteFile,
};
```

`export`ë¥¼ ì´ìš©í•´ ë‹¤ë¥¸ íŒŒì¼ì—ì„œ êµ¬í˜„ëœ í•¨ìˆ˜ë“¤ì„ ëª¨ë‘ ë‹¤ì‹œ ë‚´ë³´ë‚¸ë‹¤.<br/>
ì•ìœ¼ë¡œ `fileApi` í´ë”ì•ˆì— êµ¬í˜„ëœ í•¨ìˆ˜ë“¤ì€ `./src/fileApi`ì—ì„œ ê°€ì ¸ì™€ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.<br/>

### ê·¸ëŸ´ë“¯í•œ ê°€ì§œ ë°ì´í„° ë§Œë“¤ê¸°

ì•ê³¼ ë™ì¼í•˜ê²Œ `chance` íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•´ ê·¸ëŸ´ë“¯í•œ ê°€ì§œ ë°ì´í„°ë¥¼ ìƒì„±í•  ìˆ˜ ìˆë‹¤.<br/>
`IFake`ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ í”„ë¡œí•„ ì •ë³´ë¥¼ ê°–ëŠ” ì¸í„°í˜ì´ìŠ¤ë¥¼ ì•„ë˜ì™€ ê°™ì´ êµ¬í˜„í•œë‹¤.<br/>

-   `fake/IFake.ts`

```typescript
export interface IFake {
    name: string;
    email: string;
    sentence: string;
    profession: string;
    birthday: Date;
}
```

`chance` íŒ¨í‚¤ì§€ë¥¼ ì´ìš©í•´ `IFake` ì¸í„°í˜ì´ìŠ¤ í˜•íƒœì˜ ë°ì´í„°ë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì‘ì„±í•œë‹¤.<br/>

-   `fake/makeFakeData.ts`

```typescript
import Chance from "chance";
import { IFake } from "./IFake";

const c = new Chance();

export const makeFakeData = (): IFake => ({
    name: c.name(),
    email: c.email(),
    profession: c.profession(),
    birthday: c.birthday(),
    sentence: c.sentence(),
});

export { IFake };
```

ì•„ë˜ ì½”ë“œë¡œ ì‘ì„±í•œ `makeFakeData` í•¨ìˆ˜ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤.<br/>

-   `test/makeFakeData-Test.ts`

```typescript
import { makeFakeData, IFake } from "../fake/makeFakeData";

const fakeData: IFake = makeFakeData();
console.log(fakeData);
// {
//   name: 'Wayne Jenkins',
//   email: 'dair@di.bh',
//   profession: 'Payroll Specialist',
//   birthday: 1992-12-07T17:00:56.753Z,
//   sentence: 'Lo udtizro lezirezu uh opeweten uki eve bob atrepij polur zuwu hoowuse vi focbus.'
// }
```

ìœ„ì™€ ê°™ì´ `IFake` ì¸í„°í˜ì´ìŠ¤ ì†ì„±ì„ ê°–ëŠ” ê°€ì§œ ë°ì´í„°ê°€ ìƒì„±ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/>

### Object.keysì™€ Object.values í•¨ìˆ˜ ì‚¬ìš©í•˜ê¸°

CSV íŒŒì¼ì„ ë§Œë“¤ê¸° ìœ„í•´ì„œëŠ” ê°ì²´ì˜ ì†ì„±ê³¼ ê°’ì„ ë¶„ë¦¬í•´ì•¼ í•œë‹¤.<br/>
ì´ ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í•¨ìˆ˜ëŠ” `Object.keys`ì™€ `Object.values` í•¨ìˆ˜ë‹¤.<br/>
ì•„ë˜ì˜ ì½”ë“œëŠ” ì´ ë‘ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ ê°ì²´ì˜ ì†ì„± ì´ë¦„ê³¼ ì†ì„± ê°’ìœ¼ë¡œ êµ¬ì„±ëœ ë°°ì—´ì„ ë°˜í™˜í•œë‹¤.<br/>

-   `test/keys-values-Test.ts`

```typescript
import { IFake, makeFakeData } from "../fake/makeFakeData";

const data: IFake = makeFakeData();

const keys = Object.keys(data);
console.log("keys :", keys);
// keys : [ 'name', 'email', 'profession', 'birthday', 'sentence' ]

const values = Object.values(data);
console.log("values :", values);
// values : [
//   'Harriet Carpenter',
//   'jumibe@mono.tf',
//   'Security Director',
//   1968-04-06T22:39:20.764Z,
//   'Muz uw veglivun ho metbifi ta su vefniiw bif wolawi lervimba weogjo al aluko vudatzur.'
// ]
```

ìœ„ì™€ ê°™ì´ `IFake` íƒ€ì… ê°ì²´ì˜ ì†ì„± ì´ë¦„ê³¼ ê°’ì´ ë¶„ë¦¬ë˜ì–´ ë°˜í™˜ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/>

### CSV íŒŒì¼ ë§Œë“¤ê¸°

ê°€ì§œ ë°ì´í„°ë¥¼ ì—¬ëŸ¬ ê°œ ìƒì„±í•´ CSV íŒŒì¼ì— ì“°ê¸°ìœ„í•´ ì•„ë˜ì˜ `range` í•¨ìˆ˜ë¥¼ êµ¬í˜„í•œë‹¤.<br/>

-   `utils/range.ts`

```typescript
export function* range(max: number, min: number = 0) {
    while (min < max) {
        yield min++;
    }
}
```

ì´ì œ ì•ì—ì„œ êµ¬í˜„í•œ í•¨ìˆ˜ë“¤ì„ ì‚¬ìš©í•´ `numberOfItems` ë§Œí¼ `IFake` ê°ì²´ë¥¼ ìƒì„±í•œë‹¤.<br/>
ê·¸ í›„ ì†ì„±ëª…ê³¼ ì†ì„±ê°’ì˜ ë°°ì—´ì„ ê°ê° ì¶”ì¶œí•´ `filename` íŒŒì¼ì„ ìƒì„±í•  ìˆ˜ ìˆë‹¤.<br/>

-   `fake/writeCsvFormatFakeData.ts`

```typescript
import * as path from "path";
import { IFake, makeFakeData } from "./makeFakeData";
import { mkdir, writeFile, appendFile } from "../fileApi";
import { range } from "../utils/range";

export const writeCsvFormatFakeData = async (
    filename: string,
    numberOfItems: number
): Promise<string> => {
    const dirname = path.dirname(filename),
        comma = ",",
        newLine = "\n";
    await mkdir(dirname);

    for (let n of range(numberOfItems)) {
        const fake: IFake = makeFakeData();

        if (n == 0) {
            const keys = Object.keys(fake).join(comma);
            await writeFile(filename, keys);
        }

        const values = Object.values(fake).join(comma);
        await appendFile(filename, newLine + values);
    }

    return `write ${numberOfItems} items to ${filename} file.`;
};
```

CSV íŒŒì¼ì˜ ì²« ì¤„ì€ ê°ì²´ì˜ ì†ì„± ì´ë¦„ì„ ì‰¼í‘œë¡œ êµ¬ë¶„í•´ì„œ ì‘ì„±í•´ì•¼ í•œë‹¤.<br/>
ë”°ë¼ì„œ `Object.keys(fake).join(comma)` ê°™ì´ ì†ì„± ì´ë¦„ ë°°ì—´ì— `join` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ êµ¬í˜„í•˜ì˜€ë‹¤.<br/>
ì´í›„ì—ëŠ” `Object.values(fake).join(comma)` ê°™ì´ ì†ì„± ê°’ ë°°ì—´ì„ `join` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ ì¶”ê°€í•œë‹¤.<br/>
ì§€ê¸ˆê¹Œì§€ êµ¬í˜„í•œ íŒŒì¼ë“¤ì„ ì‚¬ìš©í•˜ê¸° ì‰½ê²Œ `src/fake` í´ë”ì— `index.ts` íŒŒì¼ì„ ì‘ì„±í•œë‹¤.<br/>

-   `fake/index.ts`

```typescript
import { IFake, makeFakeData } from "./makeFakeData";
import { writeCsvFormatFakeData } from "./writeCsvFormatFakeData";

export { IFake, makeFakeData, writeCsvFormatFakeData };
```

ìœ„ì™€ ê°™ì´ ì‘ì„±í•¨ìœ¼ë¡œì¨ `fake` í´ë” ì•ˆì— êµ¬í˜„í•œ ê¸°ëŠ¥ë“¤ì„ `src/fake` ê²½ë¡œì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.<br/>

### ë°ì´í„°ë¥¼ CSV íŒŒì¼ì— ì“°ê¸°

CSV íŒŒì¼ í¬ë§·ìœ¼ë¡œ `IFake` íƒ€ì… ê°ì²´ë¥¼ ì €ì¥í•˜ëŠ” ì½”ë“œë¥¼ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•œë‹¤.<br/>

-   `writeCsv.ts`

```typescript
import { writeCsvFormatFakeData } from "./fake";
import { getFileNameAndNumber } from "./utils/getFileNameAndNumber";

const [filename, numberOfFakeData] = getFileNameAndNumber("./data/fake", 1);
const csvFileName = `${filename}-${numberOfFakeData}.csv`;

writeCsvFormatFakeData(csvFileName, numberOfFakeData)
    .then((result) => console.log(result))
    .catch((e: Error) => console.log(e.message));
```

í„°ë¯¸ë„ì—ì„œ ì•„ë˜ì˜ ëª…ë ¹ì„ ì‹¤í–‰í•˜ë©´ `data/fake-1.csv` íŒŒì¼ì´ ìƒê¸´ë‹¤.<br/>

```shell
> ts-node src/writeCsv.ts
write 1 items to ./data/fake-1.csv file.
```

`fake-1.csv` íŒŒì¼ì„ ì—´ì–´ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ `IFake` íƒ€ì… ë°ì´í„°ê°€ ì‘ì„±ë˜ì–´ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/>

```csv
name,email,profession,birthday,sentence
Christina Adams,kitode@uzka.bm,Chiropractor,Thu Apr 28 1966 04:41:51 GMT+0900 (ëŒ€í•œë¯¼êµ­ í‘œì¤€ì‹œ),Atevan wilga los futdis duvurso nawos mitah loh zuhvahjub kijtigvac omior paariji wif owvivcer.
```

ë” ë§ì€ ë°ì´í„°ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•´ ì•„ë˜ì™€ ê°™ì´ 10ë§Œê°œì˜ ë°ì´í„°ë¥¼ ìƒì„±í•˜ëŠ” ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•œë‹¤.<br/>

```shell
> ts-node src/writeCsv.ts data/fake 100000
```

ë§ˆì°¬ê°€ì§€ë¡œ íŒŒì¼ì„ í™•ì¸í•´ë³´ë©´ ì •ìƒì ìœ¼ë¡œ ë°ì´í„°ë“¤ì´ ìƒì„±ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/>

### zip í•¨ìˆ˜ ë§Œë“¤ê¸°

CSV íŒŒì¼ì€ ì²« ì¤„ì— ê°ì²´ì˜ ì†ì„± ì´ë¦„ì´ ìˆê³  ë‘ ë²ˆì§¸ ì¤„ë¶€í„°ëŠ” ì†ì„±ê°’ë“¤ë§Œ ì¡´ì¬í•œë‹¤.<br/>
ì´ë¥¼ ê³ ë ¤í•˜ë©´ ê°ì²´ì˜ ì†ì„±ëª… ë°°ì—´ê³¼ ì†ì„±ê°’ ë°°ì—´ì„ ê²°í•©í•´ ê°ì²´ë¥¼ ë§Œë“œëŠ” í•¨ìˆ˜ê°€ í•„ìš”í•˜ë‹¤.<br/>
ì´ì™€ ê°™ì€ ê¸°ëŠ¥ì„ í•˜ëŠ” í•¨ìˆ˜ë¥¼ ì•„ë˜ì™€ ê°™ì´ `zip`ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.<br/>

```typescript
const zip = (keys: string[], values: any[]): object => {};
```

ì•„ë˜ì˜ ì½”ë“œëŠ” ì†ì„±ëª…ê³¼ ì†ì„±ê°’ì„ í•©ì³ ê°ì²´ë¥¼ ë§Œë“œëŠ” `zip` í•¨ìˆ˜ë¥¼ êµ¬í˜„í•œ ì½”ë“œë‹¤.<br/>

-   `utils/zip.ts`

```typescript
export const zip = (keys: string[], values: any[]) => {
    const makeObject = (key: string, value: any) => ({ [key]: value });
    const mergeObject = (a: any[]) =>
        a.reduce((sum, val) => ({ ...sum, ...val }), {});

    let tmp = keys
        .map((key, index) => [key, values[index]])
        .filter((a) => a[0] && a[1])
        .map((a) => makeObject(a[0], a[1]));

    return mergeObject(tmp);
};
```

`zip` ìœ í‹¸ í•¨ìˆ˜ë¥¼ ì‘ì„±í–ˆìœ¼ë¯€ë¡œ `utils/index.ts` íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•œë‹¤.<br/>

-   `utils/index.ts`

```typescript
import {
    getFileNameAndNumber,
    FileNameAndNumber,
} from "./getFileNameAndNumber";
import { range } from "./range";
import { zip } from "./zip";

export { getFileNameAndNumber, FileNameAndNumber, range, zip };
```

ì´ì œ ì•„ë˜ì™€ ê°™ì´ `zip` í•¨ìˆ˜ë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.<br/>

-   `test/zip-Test.ts`

```typescript
import { zip } from "../utils";
import { makeFakeData, IFake } from "../fake";

const data = makeFakeData();
const keys = Object.keys(data),
    values = Object.values(data);

const fake: IFake = zip(keys, values) as IFake;
console.log(fake);
// {
//     name: 'Antonio Mendez',
//     email: 'ni@pawruric.gu',
//     profession: 'Human Resources Manager',
//     birthday: 1996-11-13T04:02:05.320Z,
//     sentence: 'If fu boz ji cu ihubiuh sajowna nukafih sefas cizet kisukce pakucugo zep nam owivam vav.'
//  }
```

`Object.keys`ì™€ `Object.values`ë¥¼ ì´ìš©í•´ ì†ì„±ëª…, ì†ì„±ê°’ ë°°ì—´ì„ ë§Œë“  í›„ `zip` í•¨ìˆ˜ë¡œ í•©ì³ `IFake` íƒ€ì… ê°ì²´ë¥¼ ë§Œë“ ë‹¤.<br/>

### CSV íŒŒì¼ ë°ì´í„° ì½ê¸°

íŒŒì¼ì„ ì½ëŠ” ê¸°ëŠ¥ì„ ìƒì„±ê¸° ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•  ë•Œì—ëŠ” `fs.readFile` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ë‹¤.<br/>
ìƒì„±ê¸°ë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  `fs.readFile` í•¨ìˆ˜ë§Œ ì‚¬ìš©í•´ êµ¬í˜„í•˜ë©´ ë©”ëª¨ë¦¬ë¥¼ ë§ì´ ì‚¬ìš©í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí•œë‹¤.<br/>
ì´ ë¬¸ì œì˜ í•´ë²•ì€ íŒŒì¼ì„ í•œ ì¤„ì”© ì½ëŠ” ë°©ì‹ìœ¼ë¡œ ìƒì„±ê¸°ë¥¼ êµ¬í˜„í•˜ëŠ” ê²ƒì´ë‹¤.<br/>
ì•„ë˜ì˜ ì½”ë“œëŠ” ìƒì„±ê¸°ë¥¼ ì´ìš©í•´ íŒŒì¼ì„ í•œ ì¤„ì”© ì½ëŠ” ë°©ì‹ì„ êµ¬í˜„í•œ ì½”ë“œë‹¤.<br/>

-   `fileApi/readFileGenerator.ts`

```typescript
import * as fs from "fs";

export function* readFileGenerator(filename: string): any {
    let fd: any;

    try {
        fd = fs.openSync(filename, "rs");
        const stats = fs.fstatSync(fd);
        const bufferSize = Math.min(stats.size, 1024);
        const buffer = Buffer.alloc(bufferSize + 4);
        let filepos = 0,
            line;

        while (filepos > -1) {
            [line, filepos] = readLine(fd, buffer, bufferSize, filepos);

            if (filepos > -1) {
                yield line;
            }
        }

        yield buffer.toString();
    } catch (e) {
        console.error("readLine :", e.message);
    } finally {
        fd && fs.closeSync(fd);
    }
}

function readLine(
    fd: any,
    buffer: Buffer,
    bufferSize: number,
    position: number
): [string, number] {
    let line = "",
        readSize;
    const crSize = "\n".length;

    while (true) {
        readSize = fs.readSync(fd, buffer, 0, bufferSize, position);

        if (readSize > 0) {
            const temp = buffer.toString("utf8", 0, readSize);
            const index = temp.indexOf("\n");

            if (index > -1) {
                line += temp.substr(0, index);
                position += index + crSize;
                break;
            } else {
                line += temp;
                position += temp.length;
            }
        } else {
            position = -1;
            break;
        }
    }

    return [line.trim(), position];
}
```

ìœ„ ì½”ë“œëŠ” 1024Byteì˜ Buffer íƒ€ì… ê°ì²´ë¥¼ ìƒì„±í•´ íŒŒì¼ì„ 1024Byteì”© ì½ëŠ”ë‹¤.<br/>
ì½ì€ íŒŒì¼ì—ì„œ í•œ ì¤„ì”© ì°¾ì€ ë’¤ ì°¾ì€ ì¤„ì˜ ë°ì´í„°ë¥¼ `yield` ë¬¸ìœ¼ë¡œ ë°˜í™˜í•˜ëŠ” ë°©ì‹ì´ë‹¤.<br/>
ì‘ì„±í•œ í•¨ìˆ˜ë¥¼ ê°€ì ¸ì˜¤ê¸° ì‰½ë„ë¡ `fileApi/index.ts`ë¥¼ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•œë‹¤.<br/>

-   `fileApi/index.ts`

```typescript
import { mkdir } from "./mkdir";
import { rmdir } from "./rmdir";
import { readFile } from "./readFile";
import { writeFile } from "./writeFile";
import { fileExists } from "./fileExists";
import { appendFile } from "./appendFile";
import { deleteFile } from "./deleteFile";
import { readFileGenerator } from "./readFileGenerator";

export {
    fileExists,
    mkdir,
    rmdir,
    writeFile,
    readFile,
    appendFile,
    deleteFile,
    readFileGenerator,
};
```

ì•„ë˜ì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‘ì„±í•´ `readFileGenerator` í•¨ìˆ˜ë¥¼ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆë‹¤.<br/>

-   `test/readFileGenerator-Test.ts`

```typescript
import { readFileGenerator } from "../fileApi";

for (let value of readFileGenerator("data/fake-100000.csv")) {
    console.log("<line>", value, "</line >");
    // <line> name,email,profession,birthday,sentence </line >
    break;
}
```

ê°ì²´ì˜ ì†ì„±ëª…ì„ ì €ì¥í•œ ì²«ë²ˆ ì§¸ ì¤„ì´ ì •ìƒì ìœ¼ë¡œ ì½íˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/>
`readFileGenerator` í•¨ìˆ˜ëŠ” ë‹¨ìˆœíˆ íŒŒì¼ì„ í•œ ì¤„ í•œì¤„ ì½ëŠ” ì—­í• ì„ í•œë‹¤.<br/>
ì•„ë˜ êµ¬í˜„í•œ `csvFileReaderGenerator` í•¨ìˆ˜ëŠ” CSV íŒŒì¼ì„ í•´ì„í•˜ë©° ì½ëŠ” ê¸°ëŠ¥ì„ í•œë‹¤.<br/>

-   `csv/csvFileReaderGenerator.ts`

```typescript
import { readFileGenerator } from "../fileApi";
import { zip } from "../utils";

export function* csvFileReaderGenerator(filename: string, delim: string = ",") {
    let header = [];

    for (let line of readFileGenerator(filename)) {
        if (!header.length) {
            header = line.split(delim);
        } else {
            yield zip(header, line.split(delim));
        }
    }
}
```

ì•ì„œ êµ¬í˜„í•œ `zip` ìœ í‹¸ í•¨ìˆ˜ë¥¼ ì´ìš©í•´ ê°ì²´ë¥¼ ë§Œë“¤ì–´ `yield` ë¬¸ìœ¼ë¡œ ë°˜í™˜í•˜ê²Œ ëœë‹¤.<br/>
`src` í´ë”ì— `readCsv.ts` íŒŒì¼ì„ ìƒìƒí•´ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•´ í…ŒìŠ¤íŠ¸í•œë‹¤.<br/>

-   `readCsv.ts`

```typescript
import { getFileNameAndNumber } from "./utils";
import { csvFileReaderGenerator } from "./csv/csvFileReaderGenerator";

const [filename] = getFileNameAndNumber("./data/fake-100000.csv", 1);

let line = 1;

for (let object of csvFileReaderGenerator(filename)) {
    console.log(`[${line++}] ${JSON.stringify(object)}`);
}

console.log("\n read complete.");
```

ì½”ë“œë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ ì•„ë˜ì™€ ê°™ì´ 10ë§Œ ì¤„ì˜ ë°ì´í„°ë¥¼ ëª¨ë‘ ì½ì–´ ê°ì²´ë¥¼ ë§Œë“  ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/>

<img src="./images/1.png" width="600" height="auto">

ì§€ê¸ˆê¹Œì§€ëŠ” ê°€ì§œ ë°ì´í„°ë¥¼ CSV íŒŒì¼ì— ì“°ê³  ì½ëŠ” í”„ë¡œê·¸ë¨ì„ êµ¬í˜„í•˜ì˜€ë‹¤.<br/>
ì‹¤ì œ ì„œë¹„ìŠ¤ì—ëŠ” CSV íŒŒì¼ë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ë°©ë²•ë³´ë‹¤ëŠ” ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤.<br/>

[[ğŸ”ìœ„ë¡œê°€ê¸°]](#12ì¥-í”„ë¡œì íŠ¸-ì‹¤ìŠµ)&nbsp; / &nbsp;[[ğŸ”™ë’¤ë¡œê°€ê¸°]](https://github.com/alstn2468/DoIt_Typescript_Programming/blob/master/README.md)

## 12-2 ëª½ê³ DBì— ë°ì´í„° ì €ì¥í•˜ê¸°

### ëª½ê³ DBë€?

ë°ì´í„°ë² ì´ìŠ¤ëŠ” í¬ê²Œ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ì™€ NoSQL ë°ì´í„°ë² ì´ìŠ¤ë¡œ ë‚˜ëˆ„ì–´ì ¸ ìˆë‹¤.<br/>
ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œì€ SQLì´ë¼ê³  ë¶€ë¥´ëŠ” ë°ì´í„° ì§ˆì˜ ì–¸ì–´ë¥¼ ì‚¬ìš©í•œë‹¤.<br/>
ë°˜ë©´ì— ëª½ê³ DBì™€ ê°™ì€ NoSQL ì‹œìŠ¤í…œì€ SQLì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ë‹¤ë¥¸ ë°©ì‹ì˜ ì§ˆì˜ì–´ë¥¼ ì‚¬ìš©í•œë‹¤.<br/>
ëª½ê³ DBëŠ” ì˜¤í”ˆì†ŒìŠ¤ì´ë¯€ë¡œ ë¬´ë£Œë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê³  ëª½ê³  DB ì•„í‹€ë¼ìŠ¤ ê°™ì€ í´ë¼ìš°ë“œ ì„œë¹„ìŠ¤ë„ ì œê³µí•œë‹¤.<br/>

### ëª½ê³ DB ì„¤ì¹˜

ì•„ë˜ì˜ ëª…ë ¹ì–´ë¥¼ ì´ìš©í•´ ëª½ê³ DBë¥¼ ì„¤ì¹˜í•  ìˆ˜ ìˆë‹¤.<br/>

-   Window í™˜ê²½

```shell
> scoop install mongodb
> mongod --install
> net start mongodb
```

-   MacOS í™˜ê²½

```shell
> brew tap mongodb/brew
> xcode-select --install # gcc ì„¤ì¹˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•  ê²½ìš° ì„¤ì¹˜
> brew install gcc # gccê°€ ì—†ë‹¤ê³  í•  ê²½ìš° ì„¤ì¹˜
> brew install mongodb-community
> brew services start mongodb-community # ì‹œì‘ ëª…ë ¹ì–´
> brew services stop mongodb-community # ì¢…ë£Œ ëª…ë ¹ì–´
```

ì±…ì—ì„œëŠ” Window í™˜ê²½ìœ¼ë¡œ ì„¤ì¹˜ë¥¼ ì§„í–‰í•˜ì˜€ì§€ë§Œ MacOSì—ì„œ ì§„í–‰í•˜ë¯€ë¡œ ê´€ë ¨ ë‚´ìš©ì„ ì¶”ê°€í•˜ì˜€ë‹¤.<br/>

### í”„ë¡œì íŠ¸ êµ¬ì„±

12-1ì˜ í”„ë¡œì íŠ¸ì— ëª½ê³ DB ì ‘ì† ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€ì ìœ¼ë¡œ ì‚¬ìš©í•œë‹¤.<br/>
ëª½ê³ DBëŠ” ê±°ì˜ ëª¨ë“  í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë¡œ êµ¬í˜„ëœ ì ‘ì† ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì œê³µí•œë‹¤.<br/>
JavascriptëŠ” `mongodb`ë¼ëŠ” ì´ë¦„ì˜ íŒ¨í‚¤ì§€ë¥¼ ì‚¬ìš©í•˜ë©´ ëª½ê³ DBì— ì ‘ì†í•  ìˆ˜ ìˆë‹¤.<br/>

```shell
> npm i -S mongodb
> npm i -D @types/mongodb
```

ìœ„ì˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ `mongodb`ì™€ `@types/mongodb` íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ì¤€ë‹¤.<br/>

-   `package.json`

```json
{
    "name": "ch12_2",
    "version": "1.0.0",
    "devDependencies": {
        "@types/chance": "^1.1.0",
        "@types/mkdirp": "^0.5.2",
        "@types/mongodb": "^3.3.12",
        "@types/node": "^14.0.27",
        "@types/rimraf": "^3.0.0",
        "ts-node": "^8.10.2",
        "typescript": "^3.9.7"
    },
    "dependencies": {
        "chance": "^1.1.6",
        "mkdirp": "^0.5.1",
        "mongodb": "^3.3.5",
        "rimraf": "^3.0.2"
    }
}
```

ìµœì¢…ì ìœ¼ë¡œ êµ¬ì„±ëœ í”„ë¡œì íŠ¸ì˜ `package.json`ì€ ìœ„ì™€ ê°™ë‹¤.<br/>
12-1ì—ì„œ ì‚¬ìš©í•œ `src`í´ë”ë¥¼ ë³µì‚¬í•´ ë¶™ì—¬ë„£ìœ¼ë©´ êµ¬ì„±ì´ ì™„ë£Œëœë‹¤.<br/>

### ëª½ê³ DBì— ì ‘ì†í•˜ê¸°

ëª½ê³ DB ê´€ë ¨ ìœ í‹¸ í•¨ìˆ˜ë¥¼ ì‘ì„±í•˜ê¸° ìœ„í•´ `src` í´ë”ì— `mongodb` í´ë”ë¥¼ ìƒì„±í•œë‹¤.<br/>

```shell
> mkdir -p src/mongodb
```

`mongodb` íŒ¨í‚¤ì§€ê°€ ì œê³µí•˜ëŠ” `MongoClient` ê°ì²´ì˜ `connect` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ëª½ê³ DBì— ì ‘ì†í•  ìˆ˜ ìˆë‹¤.<br/>
ì•„ë˜ì˜ ì½”ë“œëŠ” 27017 í¬íŠ¸ì— ì‹¤í–‰ì¤‘ì¸ ëª½ê³ DBì— ì ‘ì†í•˜ëŠ” ì½”ë“œë‹¤.<br/>

-   `mongodb/connect.ts`

```typescript
import MongoClient from "mongodb";

export const connect = (mongoUrl: string = "mongodb://localhost:27017") =>
    MongoClient.connect(mongoUrl, {
        useNewUrlParser: true,
        useUnifiedTopology: true,
    });
```

`mongodb` íŒ¨í‚¤ì§€ê°€ ì œê³µí•˜ëŠ” ì„œë¹„ìŠ¤ëŠ” ëª¨ë‘ `Promise`ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë™ì‘í•œë‹¤.<br/>
ì•„ë˜ì˜ í…ŒìŠ¤íŠ¸ ì½”ë“œëŠ” `mongodb`ê°€ ê¶Œì¥í•˜ëŠ” ëª½ê³ DB ì—°ê²° ì½”ë“œë‹¤.<br/>

-   `test/connect-Test.ts`

```typescript
import { connect } from "../mongodb/connect";

const connectTest = async () => {
    let connection;

    try {
        connection = await connect();
        console.log("connection OK", connection);
    } catch (e) {
        console.log(e.message);
    } finally {
        connection.close();
    }
};

connectTest();
```

-   `test/connect-Test.ts` ì‹¤í–‰ ê²°ê³¼

<img src="./images/2.png" width="500" height="auto">

ì½”ë“œë¥¼ ì‹¤í–‰í–ˆì„ ë•Œ ì •ìƒì ìœ¼ë¡œ ì—°ê²°ë˜ë©´ ìœ„ì™€ ê°™ì´ `connection OK` ë©”ì‹œì§€ì™€ ì ‘ì† ì •ë³´ê°€ ì¶œë ¥ëœë‹¤.<br/>

### ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°

ë°ì´í„°ë² ì´ìŠ¤ ì‹œìŠ¤í…œì€ ë³´í†µ ì—¬ëŸ¬ ê°œì˜ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë‹´ì„ ìˆ˜ ìˆë‹¤.<br/>
ê° ë°ì´í„°ë² ì´ìŠ¤ëŠ” ìì‹ ë§Œì˜ ì´ë¦„ì„ ê°€ì§€ë©° ì•„ë˜ ì½”ë“œëŠ” `ch12-2`ë¼ëŠ” ì´ë¦„ì˜ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.<br/>

```typescript
const db = await connection.db("ch12-2");
```

ì•ì— ì‘ì„±í•œ `connect-Test.ts` íŒŒì¼ì— ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ë‚´ìš©ì„ ì¶”ê°€í•´ ì•„ë˜ì™€ ê°™ì´ ì‘ì„±í•œë‹¤.<br/>

-   `test/makedb-Test.ts`

```typescript
import { connect } from "../mongodb/connect";

const makedbTest = async () => {
    let connection;

    try {
        connection = await connect();
        const db = await connection.db("ch12-2");
        console.log("db", db);
    } catch (e) {
        console.log(e.message);
    } finally {
        connection.close();
    }
};

makedbTest();
```

-   `test/makedb-Test.ts` ì‹¤í–‰ ê²°ê³¼

<img src="./images/3.png" width="500" height="auto">

ìœ„ì™€ ê°™ì´ ìƒì„±ëœ ëª½ê³ DB ë°ì´í„°ë² ì´ìŠ¤ì˜ ì •ë³´ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/>
ë°ì´í„°ë² ì´ìŠ¤ê°€ ì´ë¯¸ ë§Œë“¤ì–´ì ¸ìˆëŠ” ê²½ìš° ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ìƒì„±í•˜ì§€ ì•Šê³  ì´ìš©í•  ìˆ˜ ìˆë‹¤.<br/>

### ì»¬ë ‰ì…˜ì´ë€?

ë°ì´í„°ë² ì´ìŠ¤ì—ëŠ” ì—¬ëŸ¬ ì¢…ë¥˜ì˜ ë°ì´í„°ë¥¼ ì €ì¥í•  ìˆ˜ ìˆë‹¤.<br/>
ì¼ë°˜ì ìœ¼ë¡œ ê´€ê³„í˜• DBë“¤ì€ **í…Œì´ë¸”**ì„ ë§Œë“¤ê³  ì—¬ê¸°ì— ê´€ë ¨ëœ ë°ì´í„°ë¥¼ ì €ì¥í•œë‹¤.<br/>
**í…Œì´ë¸”**ì— ì €ì¥ë˜ëŠ” í•œ ê°œì˜ ë°ì´í„°ë¥¼ **ë ˆì½”ë“œ**ë¼ê³  í•œë‹¤.<br/>
ëª½ê³ DBë„ ê´€ê³„í˜• DBì™€ ë¹„ìŠ·í•˜ì§€ë§Œ **í…Œì´ë¸”**ì´ë¼ëŠ” ìš©ì–´ ëŒ€ì‹ ì— **ì»¬ë ‰ì…˜**ì„ ì‚¬ìš©í•œë‹¤.<br/>
ë°ì´í„°ë¥¼ í‘œí˜„í•˜ëŠ” **ë ˆì½”ë“œ**ë¼ëŠ” ìš©ì–´ ëŒ€ì‹ ì— **ë¬¸ì„œ**ë¼ëŠ” ìš©ì–´ë¥¼ ì‚¬ìš©í•œë‹¤.<br/>

-   ê´€ê³„í˜• DBì™€ ëª½ê³ DB ìš©ì–´ ë¹„êµ

|        êµ¬ë¶„        | ê´€ê³„í˜• DB | ëª½ê³  DB |
| :----------------: | :-------: | :-----: |
|   í•œ ê°œì˜ ë°ì´í„°   |  ë ˆì½”ë“œ   |  ë¬¸ì„œ   |
| ê´€ë ¨ëœ ë°ì´í„° ì „ì²´ |  í…Œì´ë¸”   | ì»¬ë ‰ì…˜  |

ì•„ë˜ ì½”ë“œëŠ” ê°ê° `persons`ì™€ `addresses`ë¼ëŠ” ì´ë¦„ì˜ ì»¬ë ‰ì…˜ì„ ìƒì„±í•˜ëŠ” ì½”ë“œë‹¤.<br/>

```typescript
const personCollection = db.collection("persons");
const addressesCollection = db.collection("addresses");
```

`makedb-Test.ts`ì— ì»¬ë ‰ì…˜ì„ ë§Œë“œëŠ” ë‚´ìš©ì„ ì¶”ê°€í•´ `collection-Test.ts`ë¥¼ ì‘ì„±í•œë‹¤.<br/>

-   `test/colleciton-Test.ts`

```typescript
import { connect } from "../mongodb/connect";

const makeCollectionsTest = async () => {
    let connection;

    try {
        connection = await connect();
        const db = await connection.db("ch12-2");
        const personsCollection = db.collection("persons");
        const addressesCollection = db.collection("addresses");
        console.log(personsCollection, addressesCollection);
    } catch (e) {
        console.log(e.message);
    } finally {
        connection.close();
    }
};

makeCollectionsTest();
```

-   `test/colleciton-Test.ts` ì‹¤í–‰ ê²°ê³¼

<img src="./images/4.png" width="500" height="auto">

ìœ„ì™€ ê°™ì´ ìƒì„±ëœ `persons`, `addresses` ì»¬ë ‰ì…˜ì— ê´€í•œ ì •ë³´ë“¤ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/>

### ë¬¸ì„œë¥¼ ì»¬ë ‰ì…˜ì— ì €ì¥í•˜ê¸°

ì»¬ë ‰ì…˜ì— í•œ ê°œì˜ ë¬¸ì„œë¥¼ ì €ì¥í•˜ëŠ” ê²ƒì€ ì»¬ë ‰ì…˜ ê°ì²´ì˜ `insertOne` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•œë‹¤.<br/>

```typescript
const personsCollection = db.collection("persons");
const person = { name: "Jack", age: 32 };
let result = await personsCollection.insertOne(person);
```

`collection-Test.ts`ì— ë¬¸ì„œë¥¼ ì €ì¥í•˜ëŠ” ë‚´ìš©ì„ ì¶”ê°€í•´ `insertDocumnet-Test.ts`ë¥¼ ì‘ì„±í•œë‹¤.<br/>

-   `test/insertDocumnet-Test.ts`

```typescript
import { connect } from "../mongodb/connect";

const insertDocumentTest = async () => {
    let connection;

    try {
        connection = await connect();
        const db = await connection.db("ch12-2");
        const personsCollection = db.collection("persons");
        const addressesCollection = db.collection("addresses");

        const person = { name: "Jack", age: 32 };
        let result = await personsCollection.insertOne(person);
        console.log(result);

        const address = { country: "korea", city: "seoul" };
        result = await addressesCollection.insertOne(address);
        console.log(result);
    } catch (e) {
        console.log(e.message);
    } finally {
        connection.close();
    }
};

insertDocumentTest();
```

-   `test/insertDocumnet-Test.ts` ì‹¤í–‰ ê²°ê³¼

<img src="./images/5.png" width="400" height="auto">

ìœ„ì™€ ê°™ì´ í•œ ê°œì˜ ë¬¸ì„œë¥¼ ì½œë ‰ì…˜ì— ì €ì¥í•œ ëª…ë ¹ì˜ ê²°ê³¼ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/>

### ëª½ê³  ì…¸ì— ì ‘ì†í•˜ê¸°

ëª½ê³  ì…¸ì— ì ‘ì†í•˜ê¸° ìœ„í•´ì„œëŠ” `mongo` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.<br/>

```shell
> mongo
```

ìœ„ì˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì‰˜ì´ ë³€í•˜ë©° ëª½ê³  ì…¸ì— ì ‘ì†ëœë‹¤.<br/>

<img src="./images/6.png" width="800" height="auto">

í˜„ì¬ê¹Œì§€ `ch12-2`ë¼ëŠ” ì´ë¦„ì˜ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ë§Œë“¤ì—ˆë‹¤.<br/>
`ch12-2` ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì•„ë˜ì™€ ê°™ì´ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•œë‹¤.<br/>

```shell
> use ch12-2
switched to db ch12-2
```

ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì— ì„±ê³µí•˜ë©´ ì»¬ë ‰ì…˜ì— ì €ì¥ëœ ë¬¸ì„œë“¤ì„ ì•„ë˜ì™€ ê°™ì´ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/>

```shell
> db.persons.find({})
{ "_id" : ObjectId("5f3fc79fe9b60f19c230c63a"), "name" : "Jack", "age" : 32 }
> db.addresses.find({})
{ "_id" : ObjectId("5f3fc79fe9b60f19c230c63b"), "country" : "korea", "city" : "seoul" }
```

ëª½ê³  ì…¸ì—ì„œ ë¹ ì ¸ë‚˜ì˜¤ê¸° ìœ„í•´ì„œëŠ” `Ctrl + D`ë¥¼ ëˆ„ë¥´ë©´ ëœë‹¤.<br/>

### \_idì†ì„±ê³¼ ObjectId íƒ€ì…

ëª¨ë“  ëª½ê³ DB ë¬¸ì„œëŠ” `_id`ë¼ëŠ” ì´ë¦„ì˜ ì†ì„±ì„ ê°€ì§€ê³  ìˆë‹¤.<br/>
ì´ ì†ì„±ì€ ë¬¸ì„œê°€ DBì— ì €ì¥ë  ë•Œ ìë™ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ë‹¤.<br/>
`_id` ê°’ì€ `ObjectId('ë¬¸ìì—´')` í˜•íƒœë¡œ ì¶œë ¥ì´ ë˜ê²Œ ëœë‹¤.<br/>

```typescript
import { ObjectId } from "mongodb";
```

í”„ë¡œê·¸ë¨ì—ì„œ `ObjectId`ëŠ” ìœ„ì˜ ì½”ë“œë¡œ ì–»ì„ ìˆ˜ ìˆë‹¤.<br/>

### ë¬¸ì„œ ì°¾ê¸°

íŠ¹ì • ì»¬ë ‰ì…˜ì— ë‹´ê¸´ ë¬¸ì„œë“¤ì€ ì•„ë˜ì™€ ê°™ì€ í˜•ì‹ì˜ ì½”ë“œë¡œ ì–»ì„ ìˆ˜ ìˆë‹¤.<br/>

```typescript
let cursor = aawait ì»¬ë™ì…˜ ê°ì²´.find(ê²€ìƒ‰ ì¡°ê±´ ê°ì²´)
const foundResult = await cursor.toArray()
```

`find` ë©”ì„œë“œëŠ” ë°°ì—´ì„ ë°˜í™˜í•˜ì§€ ì•Šê³  `cursor`ë¼ëŠ” ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.<br/>
ë”°ë¼ì„œ `cursor` ê°ì²´ì˜ `toArray` ë©”ì„œë“œë¡œ Javascript ë°°ì—´ì„ ì–»ì„ ìˆ˜ ìˆë‹¤.<br/>
ì•„ë˜ëŠ” `personsCollection`ì— ì €ì¥ëœ ë¬¸ì„œ ì¤‘ `name` ì†ì„±ì´ `Jack`ì¸ ë¬¸ì„œë¥¼ ì°¾ëŠ” ì˜ˆì‹œë‹¤.<br/>

```typescript
cursor = personsCollection.find({ name: "Jack" });
```

ì¡°ê±´ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ëª¨ë“  ë¬¸ì„œë¥¼ ì–»ê¸° ìœ„í•´ì„œëŠ” ë¹ˆ ê°ì²´ `{}`ë¥¼ ì‚¬ìš©í•œë‹¤.<br/>

```typescript
cursor = addressesCollection.find({});
```

`insertDocumnet-Test.ts`ì— ë¬¸ì„œë¥¼ ì°¾ëŠ” ë‚´ìš©ì„ ì¶”ê°€í•´ `find-Test.ts`ë¥¼ ì‘ì„±í•œë‹¤.<br/>

-   `test/find-Test.ts`

```typescript
import { connect } from "../mongodb/connect";

const findDocumentTest = async () => {
    let connection, cursor;

    try {
        connection = await connect();
        const db = await connection.db("ch12-2");
        const personsCollection = db.collection("persons");
        const addressesCollection = db.collection("addresses");

        cursor = personsCollection.find({ name: "Jack" });
        const foundPersons = await cursor.toArray();
        console.log(foundPersons);
        // [ { _id: 5f3fc79fe9b60f19c230c63a, name: 'Jack', age: 32 } ]

        cursor = addressesCollection.find({});
        const foundAddresses = await cursor.toArray();
        console.log(foundAddresses);
        // [ { _id: 5f3fc79fe9b60f19c230c63b, country: 'korea', city: 'seoul' } ]
    } catch (e) {
        console.log(e.message);
    } finally {
        connection.close();
    }
};

findDocumentTest();
```

-   `test/find-Test.ts` ì‹¤í–‰ ê²°ê³¼

<img src="./images/7.png" width="450" height="auto">

ì»¬ë™ì…˜ ê°ì²´ëŠ” ì¡°ê±´ì— ë§ëŠ” ë¬¸ì„œë¥¼ í•œ ê°œ ì°¾ì•„ì£¼ëŠ” `findOne` ë©”ì„œë“œ ë˜í•œ ì œê³µí•œë‹¤.<br/>
ë¬¸ì„œê°€ í•œ ê°œì´ê¸° ë•Œë¬¸ì— `findOne`ì€ `cursor`ë¥¼ ë°˜í™˜í•˜ì§€ ì•Šê³  ë¬¸ì„œ ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.<br/>

-   `test/findOne-Test.ts`

```typescript
import { connect } from "../mongodb/connect";

const findOneTest = async () => {
    let connection, cursor;

    try {
        connection = await connect();
        const db = await connection.db("ch12-2");
        const personsCollection = db.collection("persons");

        cursor = personsCollection.find({});
        const foundPersons = await cursor.toArray();

        const _id = foundPersons[0]._id;
        const result = await personsCollection.findOne({ _id });
        console.log(result);
        // { _id: 5f3fc79fe9b60f19c230c63a, name: 'Jack', age: 32 }
    } catch (e) {
        console.log(e.message);
    } finally {
        connection.close();
    }
};

findOneTest();
```

-   `test/findOne-Test.ts` ì‹¤í–‰ ê²°ê³¼

<img src="./images/8.png" width="450" height="auto">

ìœ„ì™€ ê°™ì´ `findOne` ë©”ì„œë“œê°€ í•˜ë‚˜ì˜ ê°ì²´ë¥¼ ë°˜í™˜í•˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/>

### ë¬¸ì„œ ì‚­ì œí•˜ê¸°

ì»¬ë ‰ì…˜ì— ë‹´ê¸´ ë¬¸ì„œëŠ” `deleteOne` ë˜ëŠ” `deleteMany` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ì‚­ì œí•  ìˆ˜ ìˆë‹¤.<br/>
ë‘ ë©”ì„œë“œëŠ” `deleteCount`ë¼ëŠ” ì´ë¦„ì˜ ì†ì„±ì— ì‚­ì œëœ ë¬¸ì„œì˜ ê°œìˆ˜ê°€ ë‹´ê¸´ ê°ì²´ë¥¼ ë°˜í™˜í•œë‹¤.<br/>

```typescript
let result = await ì»¬ë™ì…˜ ê°ì²´.deleteOne(ê²€ìƒ‰ ì¡°ê±´ ê°ì²´)
result = await ì»¬ë™ì…˜ ê°ì²´.deleteMany(ê²€ìƒ‰ ì¡°ê±´ ê°ì²´)
```

ì•„ë˜ ì½”ë“œëŠ” `insertMany`ë¡œ ìƒì„±í•œ ë¬¸ì„œë¥¼ `deleteOne`ê³¼ `deletMany`ë¥¼ ì‚¬ìš©í•´ ì‚­ì œí•˜ëŠ” ì˜ˆì‹œë‹¤.<br/>

-   `test/delete-Test.ts`

```typescript
import { connect } from "../mongodb/connect";

const deleteTest = async () => {
    let connection;

    try {
        connection = await connect();
        const db = await connection.db("ch12-2");
        const personsCollection = db.collection("persons");
        await personsCollection.insertMany([
            { name: "Jack" },
            { name: "Tom" },
            { name: "Jane" },
        ]);

        let result = await personsCollection.deleteOne({ name: "Tom" });
        console.log(result); // { deletedCount: 1 }
        result = await personsCollection.deleteMany({});
        console.log(result); // { deletedCount: 2 }
    } catch (e) {
        console.log(e.message);
    } finally {
        connection.close();
    }
};

deleteTest();
```

-   `test/delete-Test.ts` ì‹¤í–‰ ê²°ê³¼

<img src="./images/9.png" width="400" height="auto">

`deleteOne`ê³¼ `deleteMany` ë©”ì„œë“œëŠ” `deletedCount`ì„ í¬í•¨í•œ ì‹¤í–‰í•œ ëª…ë ¹ì˜ ê²°ê³¼ë¥¼ ë°˜í™˜í•œë‹¤.<br/>

### ê²€ìƒ‰ ê²°ê³¼ ì •ë ¬í•˜ê¸°

`find` ë©”ì„œë“œë¡œ ê²€ìƒ‰í•œ ê²°ê³¼ëŠ” ì•„ë˜ì™€ ê°™ì´ `sort` ë©”ì„œë“œë¥¼ ì´ìš©í•´ ì •ë ¬í•  ìˆ˜ ìˆë‹¤.<br/>

```typescript
const cursor = personsCollection.find({ name: "Jack" }).sort({ age: -1 });
```

ìœ„ì˜ ì½”ë“œëŠ” `name` ì†ì„±ê°’ì´ `Jack`ì¸ ë¬¸ì„œë¥¼ `age`ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬í•œë‹¤.<br/>
ì»¬ë ‰ì…˜ì— ë¬¸ì„œì˜ ê°œìˆ˜ê°€ ë§ì•„ì§€ë©´ ê²€ìƒ‰ ì‹œê°„ì´ ëŠë ¤ì§€ê²Œ ëœë‹¤.<br/>
ì´ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œ ì»¬ë ‰ì…˜ì— `createIndex`ë¥¼ ì‚¬ìš©í•´ **ì¸ë±ìŠ¤**ë¥¼ ë§Œë“¤ê²Œ ëœë‹¤.<br/>
**ì¸ë±ìŠ¤** í•­ëª©ì€ ì•„ë˜ì™€ ê°™ì´ ì†ì„± ì´ë¦„ì— ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬ì¼ ë•ŒëŠ” `1`ì„ ë‚´ë¦¼ì°¨ìˆœì¼ ë•ŒëŠ” `-1`ì„ ì„¤ì •í•œë‹¤.<br/>

```typescript
let result = await ì»¬ë™ì…˜_ê°ì²´.createIndex({ name: 1, age: -1 });
```

ì•„ë˜ ì˜ˆì‹œëŠ” `createIndex`ë¥¼ ì‚¬ìš©í•´ **ì¸ë±ìŠ¤**ë¥¼ ìƒì„±í•´ `age`ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬í•œë‹¤.<br/>

-   `test/sort-Test.ts`

```typescript
import { connect } from "../mongodb/connect";

const sortTest = async () => {
    let connection;

    try {
        connection = await connect();
        const db = await connection.db("ch12-2");
        const personsCollection = db.collection("persons");
        await personsCollection.createIndex({ name: 1, age: -1 });
        await personsCollection.deleteMany({});
        await personsCollection.insertMany([
            { name: "Jack", age: 32 },
            { name: "Jack", age: 33 },
            { name: "Jane", age: 10 },
        ]);

        const cursor = personsCollection
            .find({ name: "Jack" })
            .sort({ age: -1 });
        const result = await cursor.toArray();
        console.log(result);
    } catch (e) {
        console.log(e.message);
    } finally {
        connection.close();
    }
};

sortTest();
```

-   `test/sort-Test.ts` ì‹¤í–‰ ê²°ê³¼

<img src="./images/10.png" width="450" height="auto">

ìœ„ì™€ ê°™ì´ `find`ë¡œ ì°¾ì€ `name`ì´ `Jack`ì¸ ë¬¸ì„œë¥¼ `age`ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬í•œ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/>

### CSV íŒŒì¼ì„ ëª½ê³ DBì— ì €ì¥í•˜ê¸°

`writeCsv.ts`ë¡œ ìƒì„±ëœ CSVíŒŒì¼ì€ `readCsv.ts`ë¥¼ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•´ ë°ì´í„°ë¥¼ ëª½ê³ DBì— ë‹´ì„ ìˆ˜ ìˆë‹¤.<br/>

```typescript
for (let object in csvFileReaderGenerator(filename)) {
    await collection.insertOne(object);
}
```

ì•„ë˜ ì½”ë“œëŠ” CSVíŒŒì¼ì„ ì½ì–´ `users` ì»¬ë ‰ì…˜ì— ì €ì¥í•˜ê³  `birthday`, `name` ì†ì„±ì— ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•œë‹¤.<br/>

-   `insertCsvToMongo.ts`

```typescript
import { connect } from "./mongodb/connect";
import { getFileNameAndNumber } from "./utils";
import { csvFileReaderGenerator } from "./csv/csvFileReaderGenerator";

const insertCsvToMongo = async (csvFileName, collectionName, index) => {
    let connection;

    try {
        connection = await connect();
        const db = await connection.db("ch12-2");
        const collection = db.collection(collectionName);

        await collection.deleteMany({});
        await collection.createIndex(index);

        let line = 1;

        for (let object of csvFileReaderGenerator(csvFileName)) {
            await collection.insertOne(object);
            console.log(`${line++} inserted.`);
        }

        console.log("\n insertion complete.");
    } catch (e) {
        console.log(e.message);
    } finally {
        connection.close();
    }
};

const [filename] = getFileNameAndNumber("./data/fake-100000.csv", 1);
insertCsvToMongo(filename, "users", { birthday: -1, name: 1 });
// 1 inserted.
// .... ìƒëµ ....
// 99999 inserted.
// 100000 inserted.
//  insertion complete.
```

-   `insertCsvToMongo.ts` ì‹¤í–‰ ê²°ê³¼

<img src="./images/11.png" width="600" height="auto">

ëª½ê³  ì…¸ì— ì ‘ì†í•œ í›„ ë¬¸ì„œì˜ ìˆ˜ë¥¼ ì•Œë ¤ì£¼ëŠ” `count()`ë¥¼ ì‚¬ìš©í•˜ë©´ 10ë§Œê°œê°€ ì €ì¥ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/>

### limitê³¼ skip ë©”ì„œë“œ

10ë§Œ ê±´ì´ë‚˜ ë˜ëŠ” ë§ì€ ë°ì´í„°ë¥¼ `find({})` í˜•íƒœë¡œ ì°¾ëŠ” ê²ƒì€ ë¬¸ì œê°€ ì¡´ì¬í•œë‹¤.<br/>
`find` ë©”ì„œë“œëŠ” ì´ëŸ° ìƒí™©ì— ëŒ€ì‘í•˜ë„ë¡ ê²€ìƒ‰ëœ ë°ì´í„°ì˜ ê°œìˆ˜ë¥¼ ì œí•œí•˜ëŠ” `limit` ë©”ì„œë“œë¥¼ ì œê³µí•œë‹¤.<br/>
ë˜í•œ í˜ì´ì§• ë“±ì˜ ê¸°ëŠ¥ì„ í•  ìˆ˜ ìˆë„ë¡ ê²°ê³¼ì˜ ì• Në²ˆì§¸ë¥¼ ê±°ë¥¼ ìˆ˜ ìˆëŠ” `skip` ë©”ì„œë“œë„ ì œê³µí•œë‹¤.<br/>
ì•„ë˜ ì½”ë“œëŠ” ê²€ìƒ‰ëœ ê²°ê³¼ ì¤‘ì— 100ë²ˆì§¸ë¶€í„° ë‹¤ì„¯ ê°œì˜ ê±´ìˆ˜ë§Œ ì„ íƒí•˜ëŠ” ì˜ˆì‹œë‹¤.<br/>

```typescript
let cursor = await usersCollection
    .find({})
    .sort({ birthday: -1, name: 1 })
    .skip(100)
    .limit(5);
```

ì•„ë˜ì™€ ê°™ì´ ì €ì¥í•œ `users` ì»¬ë ‰ì…˜ì—ì„œë„ ë™ì¼í•˜ê²Œ ì ìš©í•´ ëª½ê³ DBì—ì„œ ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.<br/>

-   `findLimitSkip.ts`

```typescript
import { connect } from "./mongodb/connect";
import { IFake } from "./fake";

const findLimitSkip = async () => {
    let connection;

    try {
        connection = await connect();
        const db = await connection.db("ch12-2");
        const usersCollection = db.collection("users");

        let cursor = await usersCollection
            .find({})
            .sort({ birthday: -1, name: 1 })
            .skip(100)
            .limit(5);
        let result = await cursor.toArray();
        console.log(
            result.map((user: IFake) => ({
                name: user.name,
                birthday: user.birthday,
            }))
        );
    } catch (e) {
        console.log(e.message);
    } finally {
        connection.close();
    }
};

findLimitSkip();
```

-   `findLimitSkip.ts` ì‹¤í–‰ ê²°ê³¼

<img src="./images/12.png" width="400" height="auto">

ìœ„ì™€ ê°™ì´ ì •ìƒì ìœ¼ë¡œ 5ê±´ì˜ ë°ì´í„°ì˜ `name` ì†ì„±ê°’ê³¼ `birthday` ì†ì„±ê°’ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/>

[[ğŸ”ìœ„ë¡œê°€ê¸°]](#12ì¥-í”„ë¡œì íŠ¸-ì‹¤ìŠµ)&nbsp; / &nbsp;[[ğŸ”™ë’¤ë¡œê°€ê¸°]](https://github.com/alstn2468/DoIt_Typescript_Programming/blob/master/README.md)

## 12-3 ìµìŠ¤í”„ë ˆìŠ¤ë¡œ API ì„œë²„ ë§Œë“¤ê¸°

### ì‹¤ìŠµ í”„ë¡œì íŠ¸ <span id="project-setup-two">êµ¬ì„±</span>

ì±•í„° 12-2ì˜ í”„ë¡œì íŠ¸ êµ¬ì¡°ì—ì„œ ì›¹ ì„œë²„ë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•´ `express` íŒ¨í‚¤ì§€ë¥¼ ì¶”ê°€ë¡œ ì‚¬ìš©í•œë‹¤.<br/>
ì•„ë˜ì˜ ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ ì¶”ê°€ì ìœ¼ë¡œ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ ì¤€ë‹¤.<br/>

```shell
> npm i -S express body-parser cors
> npm i -D @types/express @types/body-parser @types/cors
```

ë˜í•œ `package.json`ì˜ `script` í•­ëª©ì— `start` ëª…ë ¹ì–´ë¥¼ ì¶”ê°€í•œë‹¤.<br/>

-   `package.json`

```json
{
    "name": "ch12_3",
    "version": "1.0.0",
    "main": "src/index.ts",
    "scripts": {
        "start": "ts-node src"
    },
    "devDependencies": {
        "@types/body-parser": "^1.19.0",
        "@types/chance": "^1.1.0",
        "@types/cors": "^2.8.7",
        "@types/express": "^4.17.7",
        "@types/mkdirp": "^0.5.2",
        "@types/mongodb": "^3.3.12",
        "@types/node": "^14.0.27",
        "@types/rimraf": "^3.0.0",
        "ts-node": "^8.10.2",
        "typescript": "^3.9.7"
    },
    "dependencies": {
        "body-parser": "^1.19.0",
        "chance": "^1.1.6",
        "cors": "^2.8.5",
        "express": "^4.17.1",
        "mkdirp": "^0.5.1",
        "mongodb": "^3.3.5",
        "rimraf": "^3.0.2"
    }
}
```

ìµœì¢…ì ìœ¼ë¡œ ì„¤ì •ì´ ì™„ë£Œëœ `package.json`ì€ ìœ„ì™€ ê°™ë‹¤.<br/>
12-2ì—ì„œ ì‚¬ìš©í–ˆë˜ `tsconfig.json`ê³¼ `src`í´ë”ë¥¼ ë³µì‚¬í•´ ì‚¬ìš©í•˜ë©´ ëœë‹¤.<br/>

### REST ë°©ì‹ ì„œë²„

**REST**ëŠ” **HTTP**ì˜ ì£¼ìš” ì €ìì¸ ë¡œì´ í•„ë”©ì˜ 2000ë…„ ë…¼ë¬¸ì— ì†Œê°œë˜ì—ˆìœ¼ë©° 1990ë…„ ë§ì— í‘œì¤€ì´ ë˜ì—ˆë‹¤.<br/>
**REST**ëŠ” ì›¹ ì„œë²„ ì†Œí”„íŠ¸ì›¨ì–´ êµ¬ì¡°ì˜ í•˜ë‚˜ì˜ í˜•ì‹ì´ë‹¤.<br/>
**REST** ì„œë²„ëŠ” **HTTP** í”„ë¡œí† ì½œì˜ `GET`, `POST`, `DELETE` ê°™ì€ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ í´ë¼ì´ì–¸íŠ¸ì™€ í†µì‹ í•˜ëŠ” ì„œë²„ë‹¤.<br/>
**API ì„œë²„**ëŠ” **ì›¹ API ì„œë²„**ë¥¼ ê°„ë‹¨íˆ ë¶€ë¥´ëŠ” ìš©ì–´ë‹¤.<br/>
**API ì„œë²„**ëŠ” ì¼ë°˜ì ì¸ ì›¹ ì„œë²„ì™€ ë‹¬ë¦¬ `JSON` í¬ë§·ì˜ ë°ì´í„°ë§Œ ì œê³µí•˜ëŠ” ì„œë²„ë‹¤.<br/>
ëª¨ë°”ì¼ ì•±ì˜ ë³´í¸í™”ê°€ **API** ë°©ì‹ì˜ ì„œë²„ê°€ ëŒ€ì¤‘ì ìœ¼ë¡œ ì‚¬ìš©ë˜ëŠ” ê³„ê¸°ê°€ ë˜ì—ˆë‹¤.<br/>

### ìµìŠ¤í”„ë ˆìŠ¤ í”„ë ˆì„ì›Œí¬

`Node.js` í™˜ê²½ì—ì„œ **API ì„œë²„**ëŠ” ëŒ€ë¶€ë¶„ `express` í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•œë‹¤.<br/>
`express` í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ë©´ ì•„ë˜ ì½”ë“œì²˜ëŸ¼ ì›¹ ì„œë²„ë¥¼ ì‰½ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.<br/>

-   `index.js`

```typescript
import express from "express";

const app = express(),
    port = 4000;

app.get("/", (req, res) => res.json({ message: "Hello World!" })).listen(
    port,
    () => console.log(`http://localhost:${port} started...`)
);
```

ì•ì—ì„œ `scripts`ì— ì¶”ê°€í•œ `start` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ ì•„ë˜ì˜ ëª…ë ¹ìœ¼ë¡œ ì„œë²„ë¥¼ ë™ì‘ì‹œí‚¬ ìˆ˜ ìˆë‹¤.<br/>

```shell
> npm start
```

ì›¹ ì„œë²„ê°€ ì •ìƒ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•˜ê¸° ìœ„í•˜ì—¬ `http://localhost:4000` ì£¼ì†Œë¡œ ì ‘ì†í•œë‹¤.<br/>

<img src="./images/13.png" width="400" height="auto">

ìœ„ì™€ ê°™ì´ `res.json(...)` ë¶€ë¶„ì´ ì‹¤í–‰ë˜ì–´ `JSON` í¬ë§· ë°ì´í„°ê°€ ì¶œë ¥ë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/>

### ë¼ìš°íŒ… ê¸°ëŠ¥ êµ¬í˜„

`localhost:4000/users/1/2` ê²½ë¡œì˜ ì ‘ì†ì„ ì²˜ë¦¬ë¥¼ í•˜ê¸°ìœ„í•´ì„œëŠ” ì•„ë˜ì™€ ê°™ì€ êµ¬ì¡°ë¡œ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤.<br/>

```typescript
app.get('/users/:skip/:limit', ë¼ìš°í„° ì½œë°± í•¨ìˆ˜)
```

`skip`ê³¼ `limit` ì•ì— ì½œë¡ (`:`)ì€ ê²½ë¡œì—ì„œ `1`ê³¼ `2`ì™€ ê°™ì€ ê°’ì„ ì–»ê¸° ìœ„í•´ ì‚¬ìš©í•œë‹¤.<br/>

```typescript
const { skip, limit } = req.params;
```

ìœ„ì˜ ë‚´ìš©ì„ í† ëŒ€ë¡œ `index.ts` íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•œë‹¤.<br/>

-   `index.ts`

```typescript
import express from "express";

const app = express(),
    port = 4000;

app.get("/", (req, res) => res.json({ message: "Hello World!" }))
    .get("/users/:skip/:limit", (req, res) => {
        const { skip, limit } = req.params;
        res.json({ skip, limit });
    })
    .listen(port, () => console.log(`http://localhost:${port} started...`));
```

ì›¹ì„œë²„ë¥¼ ì¬ì‹œì‘í•œ í›„ `localhost:4000/users/1/2`ë¡œ ì ‘ì†í•´ í…ŒìŠ¤íŠ¸í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ê²°ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.<br/>

<img src="./images/14.png" width="450" height="auto">

ìœ„ì™€ ê°™ì´ ì ‘ì†ì— ì‚¬ìš©ëœ ì£¼ì†Œì˜ `skip`ê³¼ `limit`ê°’ì´ ì¶œë ¥ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/>

### ìµìŠ¤í”„ë ˆìŠ¤ ë¯¸ë“¤ì›¨ì–´ ì¶”ê°€

`express`ì™¸ì— ì„¤ì¹˜í•œ `bodyParser`ì™€ `cors`ë¥¼ ì‚¬ìš©í•˜ê¸° ìœ„í•´ì„œëŠ” `use` ë©”ì„œë“œë¥¼ ì‚¬ìš©í•œë‹¤.<br/>

```typescript
import bodyParser from "body-parser";
import cors from "cors";

app.use(bodyParser.urlencoded({ extended: true })).use(cors());
```

### ëª½ê³ DB ì—°ê²°

ëª½ê³ DBì— ì €ì¥ëœ ë°ì´í„°ë¥¼ ì„œë¹„ìŠ¤í•˜ë ¤ë©´ ëª½ê³ DB ì„œë²„ì— ì ‘ì†í•˜ëŠ” ì½”ë“œë¥¼ ë§Œë“¤ì–´ì•¼í•œë‹¤.<br/>
ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¥¼ í†µí•´ ëª½ê³ DB ì„œë²„ì— ì ‘ì†í•œ í›„ ì›¹ ì„œë²„ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.<br/>

-   `index.ts`

```typescript
import { connect } from "./mongodb/connect";
import { runServer } from "./runServer";

connect()
    .then(async (connection) => {
        const db = await connection.db("ch12-2");
        return db;
    })
    .then(runServer)
    .catch((e: Error) => console.log(e.message));
```

ìœ„ì—ì„œ ì‚¬ìš©í•œ `runServer` í•¨ìˆ˜ëŠ” ì•„ë˜ì™€ ê°™ì´ êµ¬í˜„í•  ìˆ˜ ìˆë‹¤.<br/>

-   `runServer.ts`

```typescript
import express from "express";
import bodyParser from "body-parser";
import cors from "cors";

export const runServer = (mongodb) => {
    const app = express(),
        port = 4000;

    app.use(bodyParser.urlencoded({ extended: true }))
        .use(cors())
        .get("/", (req, res) => res.json({ message: "Hello World!" }))
        .get("/users/:skip/:limit", async (req, res) => {
            const { skip, limit } = req.params;

            const userCollection = await mongodb.collection("users");
            const cursor = await userCollection
                .find({})
                .sort({ name: 1 })
                .skip(parseInt(skip))
                .limit(parseInt(limit));
            const result = await cursor.toArray();
            res.json(result);
        })
        .listen(port, () => console.log(`http://localhost:${port} started...`));
};
```

ì„œë²„ë¥¼ ì¬ê°€ë™í•œ í›„ `localhost:4000/users/1/2`ì˜ ê²½ë¡œë¡œ ì ‘ì†í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ìˆë‹¤.<br/>

<img src="./images/15.png" width="500" height="auto">

`JSON` í¬ë§·ì˜ ë°ì´í„°ê°€ `skip`ê³¼ `limit`ì— ë”°ë¼ ëª½ê³ DBì—ì„œ ê°’ì„ ê°€ì ¸ì™€ ë°˜í™˜í•˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/>
`localhost:4000/users/1/2`ì—ì„œ `localhost:4000/users/1/5`ë¡œ ë³€ê²½í•œë‹¤ë©´ 5ê±´ì˜ ë°ì´í„°ê°€ í‘œì‹œë  ê²ƒì´ë‹¤.<br/>

[[ğŸ”ìœ„ë¡œê°€ê¸°]](#12ì¥-í”„ë¡œì íŠ¸-ì‹¤ìŠµ)&nbsp; / &nbsp;[[ğŸ”™ë’¤ë¡œê°€ê¸°]](https://github.com/alstn2468/DoIt_Typescript_Programming/blob/master/README.md)

## 12-4 ë¦¬ì•¡íŠ¸ì™€ ë¶€íŠ¸ìŠ¤íŠ¸ë©ìœ¼ë¡œ í”„ë¡ íŠ¸ì—”ë“œ ì›¹ ë§Œë“¤ê¸°

### ì‹¤ìŠµ í”„ë¡œì íŠ¸ <span id="project-setup-three">êµ¬ì„±</span>

**API ì„œë²„**ëŠ” `JSON` í¬ë§·ì˜ ë°ì´í„°ë§Œ ë³´ë‚´ì£¼ë¯€ë¡œ ë™ì ìœ¼ë¡œ `HTML`ì„ ë§Œë“¤ì–´ ì£¼ì–´ì•¼í•œë‹¤.<br/>
ì›¹ ë¸Œë¼ìš°ì €ì—ì„œ ì´ëŸ° ë°©ì‹ìœ¼ë¡œ ë™ì‘í•˜ëŠ” ì›¹ ì„œë¹„ìŠ¤ë¥¼ **í”„ë¡ íŠ¸ì—”ë“œ ì›¹**ì´ë¼ê³  í•©ë‹ˆë‹¤.<br/>
**í”„ë¡ íŠ¸ì—”ë“œ ì›¹**ì„ ë§Œë“¤ê¸° ìœ„í•´ ì•„ë˜ì˜ ëª…ë ¹ì–´ë¡œ `React` í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•œë‹¤.<br/>

```shell
> npx create-react-app users --template typescript
```

ìœ„ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•œ ìœ„ì¹˜ì—ì„œ `users` í´ë”ê°€ ìƒì„±ë˜ê³  ê´€ë ¨ í”„ë¡œì íŠ¸ íŒŒì¼ì´ ìƒì„±ëœë‹¤.<br/>
`create-react-app`ê°€ ìƒì„±í•´ì¤€ `package.json` íŒŒì¼ì€ ì•„ë˜ì™€ ê°™ë‹¤.<br/>

-   `package.json`

```json
{
    "name": "users",
    "version": "0.1.0",
    "private": true,
    "dependencies": {
        "@testing-library/jest-dom": "^4.2.4",
        "@testing-library/react": "^9.5.0",
        "@testing-library/user-event": "^7.2.1",
        "@types/jest": "^24.9.1",
        "@types/node": "^12.12.54",
        "@types/react": "^16.9.48",
        "@types/react-dom": "^16.9.8",
        "react": "^16.13.1",
        "react-dom": "^16.13.1",
        "react-scripts": "3.4.3",
        "typescript": "^3.7.5"
    },
    "scripts": {
        "start": "react-scripts start",
        "build": "react-scripts build",
        "test": "react-scripts test",
        "eject": "react-scripts eject"
    },
    "eslintConfig": {
        "extends": "react-app"
    },
    "browserslist": {
        "production": [">0.2%", "not dead", "not op_mini all"],
        "development": [
            "last 1 chrome version",
            "last 1 firefox version",
            "last 1 safari version"
        ]
    }
}
```

`package.json`ê°€ ìˆëŠ” `users` í´ë”ë¡œ ì´ë™í•œ í›„ ì•„ë˜ì˜ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë©´ ì„œë²„ê°€ êµ¬ë™ëœë‹¤.<br/>

```shell
> npm start
```

`create-react-app`ìœ¼ë¡œ ë§Œë“  í”„ë¡œì íŠ¸ëŠ” `npm start` ëª…ë ¹ìœ¼ë¡œ êµ¬ë™ì‹œí‚¬ ìˆ˜ ìˆë‹¤.<br/>
ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ì´ ë˜ë©´ ë¸Œë¼ìš°ì €ì— `http://localhost:3000` ì£¼ì†Œë¡œ ì ‘ì†ëœë‹¤.<br/>

<img src="./images/16.png" width="500" height="auto">

ìœ„ì™€ ê°™ì´ `create-react-app`ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ `React` ì›¹ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/>

### App.tsx íŒŒì¼ ìˆ˜ì •

`create-react-app`ìœ¼ë¡œ ë§Œë“  `React`ì˜ ì½”ë“œëŠ” `src` í´ë”ì— `App.tsx`ê°€ ìˆë‹¤.<br/>

-   `App.tsx`

```tsx
import React from "react";

const App: React.FC = () => {
    const user = { name: "Jack", age: 32 };

    return <div className="App">{JSON.stringify(user)}</div>;
};

export default App;
```

`App.tsx` íŒŒì¼ì„ ìœ„ì™€ ê°™ì´ ìˆ˜ì •í•œ í›„ ì €ì¥í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ë³€ê²½ëœë‹¤.<br/>

<img src="./images/17.png" width="300" height="auto">

ì½”ë“œë¥¼ ë³€ê²½í•œ í›„ ì €ì¥í•˜ë©´ ìˆ˜ì •ëœ ë‚´ìš©ì´ ìë™ìœ¼ë¡œ ì»´íŒŒì¼ë˜ì–´ ë°˜ì˜ëœë‹¤.<br/>

### JSXë€?

`JSX`ëŠ” `Javascript XML`ì˜ ì•½ìë¡œ í˜ì´ìŠ¤ë¶ì´ ë§Œë“  ê°„ë‹¨í•œ í”„ë¡œê·¸ë˜ë° ì–¸ì–´ë‹¤.<br/>
`JSX`ëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ì˜ í™•ì¥ ê¸°ëŠ¥ í˜•íƒœë¡œ ë™ì‘í•˜ë©° `App.tsx`ì˜ ì•„ë˜ ì½”ë“œê°€ `JSX`ë‹¤.<br/>

```tsx
<div className="App">{JSON.stringify(user)}</div>
```

`JSX`ê°€ ìˆëŠ” ìë°”ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì€ `.jsx` í™•ì¥ìë¥¼ ì‚¬ìš©í•˜ë©° íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ëŠ” `.tsx`ë¥¼ ì‚¬ìš©í•œë‹¤.<br/>

```typescript
import React from "react";
```

`JSX`ê°€ ì‚¬ìš©ë˜ëŠ” íŒŒì¼ì€ ë°˜ë“œì‹œ ì²« ì¤„ì—ëŠ” ë°˜ë“œì‹œ ìœ„ì™€ ê°™ì€ `import` êµ¬ë¬¸ì´ ìˆì–´ì•¼ í•œë‹¤.<br/>

### ì»´í¬ë„ŒíŠ¸ë€?

`JSX` ì½”ë“œëŠ” ë°˜ë“œì‹œ `React`ê°€ **ì»´í¬ë„ŒíŠ¸**ë¼ê³  ë¶€ë¥´ëŠ” í•¨ìˆ˜ì˜ ë°˜í™˜ê°’ìœ¼ë¡œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.<br/>
ì•„ë˜ ì½”ë“œì—ì„œ `App`ì´ ì»´í¬ë„ŒíŠ¸ì˜ í•œ ì˜ˆì‹œì´ë©° `JSX` ì½”ë“œë¥¼ ë°˜í™˜í•œë‹¤.<br/>

```tsx
const App: React.FC = () => {
    const user = { name: "Jack", age: 32 };

    return <div className="App">{JSON.stringify(user)}</div>;
};
```

`JSX`ì½”ë“œ ë‚´ë¶€ì—ì„œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ë¬¸ë²•ì„ ì‘ì„±í•˜ê¸° ìœ„í•´ì„œëŠ” `{}`ë¡œ ê°ì‹¸ì£¼ì–´ì•¼ í•œë‹¤.<br/>

### API ì„œë²„ì—ì„œ ì‹¤ì œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°

[12-3](#12-3-ìµìŠ¤í”„ë ˆìŠ¤ë¡œ-api-ì„œë²„-ë§Œë“¤ê¸°)ì—ì„œ ê°œë°œí•œ API ì„œë²„ë¥¼ ë™ì‘ì‹œí‚¨ í›„ `React` í”„ë¡œì íŠ¸ì™€ ì—°ê²°ì„ ì§„í–‰í•œë‹¤.<br/>

```shell
> npm start
```

ìœ„ì˜ `start` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•´ API ì„œë²„ë¥¼ ë™ì‘ì‹œí‚¨ë‹¤.<br/>
ê·¸ í›„ `React` í”„ë¡œì íŠ¸ì˜ `src`í´ë”ì— `IUser.ts`íŒŒì¼ìœ¼ ìƒì„±í•œ í›„ ì‘ì„±í•œë‹¤.<br/>

-   `IUser.ts`

```typescript
export interface IUser {
    _id: string;
    name: string;
    email: string;
    sentence: string;
    profession: string;
    birthday: Date;
}
```

ê·¸ í›„ `src`í´ë”ì— 2ì°¨ ê³ ì°¨ í•¨ìˆ˜ í˜•íƒœì˜ `getDataPromise` í•¨ìˆ˜ë¥¼ ì‘ì„±í•œë‹¤.<br/>

-   `getDataPromise.ts`

```typescript
import { IUser } from "./IUser";

type GetDataPromiseCallback = (a: IUser[]) => void;

export const getDataPromise = (fn: GetDataPromiseCallback) => (
    skip: number,
    limit: number
) =>
    fetch(`http://localhost:4000/users/${skip}/${limit}`)
        .then((res) => res.json())
        .then(fn);
```

ë§ˆì§€ë§‰ìœ¼ë¡œ `App.tsx` íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•œ í›„ ì €ì¥í•´ ë°˜ì˜í•œë‹¤.<br/>

-   `App.tsx`

```tsx
import React from "react";
import { IUser } from "./IUser";
import { getDataPromise } from "./getDataPromise";

const App: React.FC = () => {
    getDataPromise((users: IUser[]) => console.log("users", users))(0, 1);

    return <div className="App">Please open console window!</div>;
};

export default App;
```

ë¸Œë¼ìš°ì €ë¥¼ ì—´ì–´ ê°œë°œì ë„êµ¬ì˜ ì½˜ì†”ì„ í™•ì¸í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ê²°ê³¼ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤.<br/>

<img src="./images/18.png" width="550" height="auto">

ìœ„ì™€ ê°™ì´ API ì„œë²„ì—ì„œ ì‹¤ì œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¨ ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.<br/>

### useState í•¨ìˆ˜ ì‚¬ìš©í•˜ê¸°

ì§€ê¸ˆê¹Œì§€ ì‘ì„±í•œ `App` ì»´í¬ë„ŒíŠ¸ì—ëŠ” í•œ ê°€ì§€ ë¬¸ì œì ì´ ìˆë‹¤.<br/>

```tsx
const App: React.FC = () => {
    getDataPromise((users: IUser[]) => console.log("users", users))(0, 1);

    return <div className="App">Please open console window!</div>;
};
```

ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ `users` ê°’ì„ ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ì—†ê³  ì½œë°± í•¨ìˆ˜ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.<br/>
`React`ëŠ” ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë„ë¡ `useState`ë¼ëŠ” ì»´í¬ë„ŒíŠ¸ ìƒíƒœê´€ë¦¬ í•¨ìˆ˜ë¥¼ ì œê³µí•œë‹¤.<br/>

```tsx
import React, { useState } from "react";
```

`useState` í•¨ìˆ˜ëŠ” ë°°ì—´ì— **ë¹„êµ¬ì¡°í™” í• ë‹¹ë¬¸**ì„ ì‚¬ìš©í•´ ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.<br/>

```typescript
const [users, setUsers] = useState<IUser[]>([]);
```

`useState`ì˜ ë°˜í™˜ê°’ì¸ ë°°ì—´ì˜ ì²«ë²ˆì§¸ ê°’ì€ **ìƒíƒœ**ì´ë©° ë‘ë²ˆì§¸ ê°’ì€ **ìƒíƒœë¥¼ ë³€ê²½í•˜ëŠ” í•¨ìˆ˜**ë‹¤.<br/>
`useState`ë¥¼ ì‚¬ìš©í•´ ì„œë²„ì—ì„œ ê°€ì ¸ì˜¨ `IUser` íƒ€ì… ë°ì´í„°ë¥¼ ì•„ë˜ì™€ ê°™ì´ ì €ì¥í•  ìˆ˜ ìˆë‹¤.<br/>

-   `App.tsx`

```tsx
const App: React.FC = () => {
    const [users, setUsers] = useState<IUser[]>([]);
    getDataPromise((receivedUsers: IUser[]) =>
        setUsers([...users, ...receivedUsers])
    )(0, 1);

    return <div className="App">{JSON.stringify(users)}</div>;
};
```

ì‘ì„±í•œ ì½”ë“œë¥¼ ì €ì¥í•œ í›„ ë¸Œë¼ìš°ì €ë¥¼ ë³´ë©´ ì•„ë˜ì™€ ê°™ì´ ì‹¤ì œ ë°ì´í„°ê°€ í‘œì‹œë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/>

<img src="./images/19.png" width="500" height="auto">

ê°€ì ¸ì˜¨ ë°ì´í„°ë¥¼ `users` ìƒíƒœì— ì €ì¥í•œ í›„ ë¬¸ìì—´ í˜•íƒœë¡œ ë³€í•œí•´ í™”ë©´ì— ë³´ì´ê²Œ ëœë‹¤.<br/>

### useEffect í•¨ìˆ˜ ì‚¬ìš©í•˜ê¸°

ì§€ê¸ˆê¹Œì§€ êµ¬í˜„í•œ `App` ì»´í¬ë„ŒíŠ¸ëŠ” ì›¹ ë¸Œë¼ìš°ì €ì— ì˜í•´ ìƒˆë¡œê³ ì¹¨ ë  ë•Œë§ˆë‹¤ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.<br/>
ReactëŠ” ì´ëŸ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•  ìˆ˜ ìˆë„ë¡ `useEffect`ë¼ëŠ” í•¨ìˆ˜ë¥¼ ì œê³µí•œë‹¤.<br/>

```typescript
import React, { useState, useEffect } from "react";
```

`useEffect` í•¨ìˆ˜ëŠ” ì•„ë˜ì™€ ê°™ì€ í˜•íƒœë¡œ ì‚¬ìš©ëœë‹¤.<br/>

```typescript
useEffect(() => {
    // êµ¬í˜„ ë‚´ìš©
}, []);
```

`useEffect` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•´ `App` ì»´í¬ë„ŒíŠ¸ë¥¼ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•œë‹¤.<br/>

```tsx
const App: React.FC = () => {
    const [users, setUsers] = useState<IUser[]>([]);

    useEffect(() => {
        getDataPromise((receivedUsers: IUser[]) =>
            setUsers([...users, ...receivedUsers])
        )(0, 1);
    }, []);

    return <div className="App">{JSON.stringify(users)}</div>;
};
```

ìœ„ì™€ ê°™ì´ ìˆ˜ì •í•˜ë©´ì„œ `getDataPromise` í•¨ìˆ˜ëŠ” `App` ì»´í¬ë„ŒíŠ¸ê°€ ì²˜ìŒ **ë Œë”ë§**ë  ë•Œë§Œ ì‹¤í–‰ëœë‹¤.<br/>

### ì„œë²„ì—ì„œ ë°ì´í„° ê³„ì† ê°€ì ¸ì˜¤ê¸°

`App` ì»´í¬ë„ŒíŠ¸ì— ë²„íŠ¼ì„ ì¶”ê°€í•´ ëˆ„ë¥¼ ë•Œë§ˆë‹¤ ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ë„ë¡ ë³€ê²½í•œë‹¤.<br/>

-   `App.tsx`

```tsx
const App: React.FC = () => {
    const limit = 1;
    const [skip, setSkip] = useState(0);
    const [users, setUsers] = useState<IUser[]>([]);
    const onClick = () => {
        getDataPromise((receivedUsers: IUser[]) => {
            setSkip(skip + limit);
            setUsers([...users, ...receivedUsers]);
        })(skip, limit);
    };

    useEffect(onClick, []);

    return (
        <div className="App">
            <p>
                <button onClick={onClick}>more data...</button>
            </p>
            <p>{JSON.stringify(users)}</p>
        </div>
    );
};
```

<img src="./images/20.png" width="550" height="auto">

ìœ„ì™€ ê°™ì´ `more data...` ë²„íŠ¼ì„ í´ë¦­í•  ê²½ìš° ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ì¶”ê°€ì ìœ¼ë¡œ ê°€ì ¸ì˜¤ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/>

### ë¶€íŠ¸ìŠ¤íŠ¸ë© CSS í”„ë ˆì„ì›Œí¬ ì‚¬ìš©í•˜ê¸°

í™”ë©´ì— ìŠ¤íƒ€ì¼ì„ ì¶”ê°€í•´ ì›¹ í˜ì´ì§€ë¥¼ ì˜ˆì˜ê²Œ ë§Œë“¤ê¸° ìœ„í•´ì„œ CSSë¥¼ ì´ìš©í•œë‹¤.<br/>
ë¶€ìŠ¤íŠ¸ë¥´ë© CSS í”„ë ˆì„ì›Œí¬ë¥¼ ì‚¬ìš©í•´ ë””ìì¸í•˜ê¸° ìœ„í•´ [ì‚¬ì´íŠ¸](https://www.bootstrapcdn.com/)ì— ì ‘ì†í•˜ë©´ ì•„ë˜ í™”ë©´ì„ ë³¼ ìˆ˜ ìˆë‹¤.<br/>

<img src="./images/21.png" width="600" height="auto">

`CSS` ë¶€ë¶„ê³¼ `Javascript Bundle` ë¶€ë¶„ì„ ë³µì‚¬í•´ `public` í´ë”ì˜ `index.html`ì— ì¶”ê°€í•œë‹¤.<br/>

```html
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <!-- ... -->
        <link
            rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
            integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
            crossorigin="anonymous"
        />
        <title>React App</title>
    </head>
    <body>
        <noscript>You need to enable JavaScript to run this app.</noscript>
        <div id="root"></div>
        <!-- ... -->
        <script
            src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"
            integrity="sha384-LtrjvnR4Twt/qOuYxE721u19sVFLVSA4hf/rRt6PrZTmiPltdZcI7q7PXQBYTKyf"
            crossorigin="anonymous"
        ></script>
    </body>
</html>
```

`CSS` ë¶€ë¶„ì€ `head` íƒœê·¸ ë‚´ë¶€ì— ì¶”ê°€í•˜ê³  `script` ë¶€ë¶„ì€ `body` ë‚´ë¶€ì— ì¶”ê°€í•œë‹¤.<br/>

### ì¹´ë“œ ì»´í¬ë„ŒíŠ¸ ë§Œë“¤ê¸°

ë¶€íŠ¸ìŠ¤íŠ¸ë©ì˜ `card` ì»´í¬ë„ŒíŠ¸ë¥¼ ì‚¬ìš©í•˜ëŠ” React ì»´í¬ë„ŒíŠ¸ë¥¼ ì•„ë˜ì™€ ê°™ì´ ë§Œë“ ë‹¤.<br/>

-   `Card.tsx`

```tsx
import React from "react";
import { IUser } from "./IUser";

const random = (max: number) => Math.floor(Math.random() * max);

export const Card: React.FC<{ user: IUser; click: () => void }> = ({
    user,
    click,
}) => {
    const { name, email, sentence, profession, birthday } = user;
    const b = new Date(birthday);
    const src = `http://source.unsplash.com/random/1000x${random(300) + 500}`;

    return (
        <div className="card">
            <img src={src} className="card-img-top" />
            <div className="card-body">
                <h5 className="card-title">
                    {name} ({email})
                </h5>
                <h6 className="card-subtitle mb-2 text-muted">
                    {profession} birthday: {b.getFullYear()}
                </h6>
                <p className="card-text">{sentence}</p>
                <a href="#" className="btn btn-primary" onClick={click}>
                    more data...
                </a>
            </div>
        </div>
    );
};
```

ê·¸ë¦¬ê³  `App.css` íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•œë‹¤.<br/>

-   `App.css`

```css
.App {
    width: 100%;
    background-color: white;
    padding: 5px;
    display: flex;
    flex-wrap: wrap;
}

.card {
    width: 22rem;
    padding: 5px;
    margin: 5px;
}
```

ë§ˆì§€ë§‰ìœ¼ë¡œ `App.tsx` íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ìˆ˜ì •í•´ ì‘ì„±í•œ ë‚´ìš©ì„ ë°˜ì˜í•œë‹¤.<br/>

-   `App.tsx`

```tsx
import React, { useState, useEffect } from "react";
import { IUser } from "./IUser";
import { getDataPromise } from "./getDataPromise";
import { Card } from "./Card";
import "./App.css";

const App: React.FC = () => {
    const limit = 1;
    const [skip, setSkip] = useState(0);
    const [users, setUsers] = useState<IUser[]>([]);
    const onClick = () => {
        getDataPromise((receivedUsers: IUser[]) => {
            setSkip(skip + limit);
            setUsers([...users, ...receivedUsers]);
        })(skip, limit);
    };

    useEffect(onClick, []);

    return (
        <div className="App">
            {users.map((user: IUser, key: number) => (
                <Card click={onClick} user={user} key={key.toString()} />
            ))}
        </div>
    );
};

export default App;
```

ë³€ê²½ì‚¬í•­ì„ ì €ì¥í•˜ë©´ ì›¹ ë¸Œë¼ìš°ì € í™”ë©´ì€ ì•„ë˜ì™€ ê°™ì´ ë³€ê²½ëœë‹¤.<br/>

<img src="./images/22.png" width="600" height="auto">

`<more data...>` ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì¹´ë“œ í˜•íƒœì˜ ì •ë³´ê°€ ì¶”ê°€ë¡œ ìƒê¸°ê²Œ ëœë‹¤.<br/>

[[ğŸ”ìœ„ë¡œê°€ê¸°]](#12ì¥-í”„ë¡œì íŠ¸-ì‹¤ìŠµ)&nbsp; / &nbsp;[[ğŸ”™ë’¤ë¡œê°€ê¸°]](https://github.com/alstn2468/DoIt_Typescript_Programming/blob/master/README.md)
